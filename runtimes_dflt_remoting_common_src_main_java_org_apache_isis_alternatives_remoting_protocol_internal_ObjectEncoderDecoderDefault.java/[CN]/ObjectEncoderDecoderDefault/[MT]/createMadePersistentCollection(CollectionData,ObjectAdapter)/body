{
  final ReferenceData[] elementData=collectionData.getElements();
  final CollectionFacet facet=CollectionFacetUtils.getCollectionFacetFromSpec(collection);
  final Iterator elements=facet.iterator(collection);
  for (int i=0; i < elementData.length; i++) {
    final ObjectAdapter element=(ObjectAdapter)elements.next();
    final Oid oid=element.getOid();
    Assert.assertNotNull(oid);
    elementData[i]=encodeMadePersistentGraph((ObjectData)elementData[i],element);
  }
  return collectionData;
}
