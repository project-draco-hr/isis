{
  DatabaseConnector connector=connectionPool.acquire();
  connector.begin();
  SqlExecutionContext context=new SqlExecutionContext(connector);
  try {
    for (int i=0; i < commands.length; i++) {
      PersistenceCommand command=commands[i];
      command.execute(context);
    }
    connector.commit();
  }
 catch (  NakedObjectRuntimeException e) {
    LOG.warn("Failure during execution",e);
    connector.rollback();
    throw e;
  }
 finally {
    connectionPool.release(connector);
  }
}
