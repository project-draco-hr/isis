{
  LOG.debug("makePersistent " + object);
  if (isPersistent(object)) {
    throw new NotPersistableException("Object already persistent");
  }
  object.setOid(createOid(object));
  if (!object.isResolved()) {
    object.setResolved();
  }
  NakedObjectField[] fields=object.getSpecification().getFields();
  for (int i=0; i < fields.length; i++) {
    NakedObjectField field=fields[i];
    if (field.isDerived()) {
      continue;
    }
 else     if (field.isValue()) {
      continue;
    }
 else     if (field instanceof OneToManyAssociation) {
      InternalCollection collection=(InternalCollection)object.getField(field);
      collection.setOid(createOid(collection));
      collection.setResolved();
      for (int j=0; j < collection.size(); j++) {
        NakedObject element=collection.elementAt(j);
        if (isPersistent(element)) {
          continue;
        }
        makePersistent(element);
      }
    }
 else {
      Object fieldValue=object.getField(field);
      if (fieldValue == null) {
        continue;
      }
      if (!(fieldValue instanceof NakedObject)) {
        throw new NakedObjectRuntimeException();
      }
      NakedObject association=(NakedObject)fieldValue;
      if (isPersistent(association)) {
        continue;
      }
      makePersistent(association);
    }
  }
  try {
    if (object.getObject() instanceof NakedClass) {
      createNakedClassSpec(object);
    }
 else {
      createObject(object);
    }
  }
 catch (  ObjectStoreException e) {
    throw new NakedObjectRuntimeException(e);
  }
  objectStore.getLoadedObjects().loaded(object);
}
