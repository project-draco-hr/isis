{
  final StringBuffer details=new StringBuffer();
  final String header=layout.getHeader();
  if (header != null) {
    details.append(header);
  }
  if (addInfo) {
    final String user=System.getProperty("user.name");
    final String system=System.getProperty("os.name") + " (" + System.getProperty("os.arch")+ ") "+ System.getProperty("os.version");
    final String java=System.getProperty("java.vm.name") + " " + System.getProperty("java.vm.version");
    final String version=AboutIsis.getFrameworkVersion();
    final LoggingEvent infoEvent=new LoggingEvent("",Logger.getRootLogger(),Level.INFO,"Snapshot:- " + new Date() + "\n\t"+ user+ "\n\t"+ system+ "\n\t"+ java+ "\n\t"+ version,null);
    details.append(layout.format(infoEvent));
  }
  final int len=buffer.length();
  String message="";
  for (int i=0; i < len; i++) {
    final LoggingEvent event=buffer.get();
    message=event.getLoggerName() + ": " + event.getMessage();
    details.append(layout.format(event));
    if (layout.ignoresThrowable()) {
      final String[] s=event.getThrowableStrRep();
      if (s != null) {
        for (        final String element : s) {
          details.append(element);
          details.append('\n');
        }
      }
    }
  }
  final String footer=layout.getFooter();
  if (footer != null) {
    details.append(footer);
  }
  writeSnapshot(message,details.toString());
}
