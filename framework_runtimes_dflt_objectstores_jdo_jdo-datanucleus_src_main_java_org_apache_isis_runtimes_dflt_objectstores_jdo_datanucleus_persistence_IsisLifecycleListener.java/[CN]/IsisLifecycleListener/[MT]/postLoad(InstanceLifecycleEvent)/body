{
  if (LOG.isDebugEnabled()) {
    LOG.debug(logString(Phase.POST,event));
  }
  if (isSuspended()) {
    LOG.debug(" [currently suspended - ignoring]");
    return;
  }
  final PersistenceCapable pojo=persistenceCapableFor(event);
  final RootOid oid;
  ObjectAdapter adapter=getAdapterManager().getAdapterFor(pojo);
  if (adapter != null) {
    ensureRootObject(event);
    oid=(RootOid)adapter.getOid();
  }
 else {
    final OidGenerator oidGenerator=getOidGenerator();
    oid=oidGenerator.createPersistent(pojo,null);
    adapter=getAdapterManager().getAdapterFor(oid);
    if (adapter != null) {
      getAdapterManager().removeAdapter(adapter);
      adapter.replacePojo(pojo);
      getAdapterManager().addExistingAdapter(adapter);
    }
 else {
      PersistenceSessionHydrator hydrator=getPersistenceSession();
      adapter=hydrator.recreateAdapter(oid,pojo);
      PersistorUtil.startResolving(adapter);
      PersistorUtil.endResolving(adapter);
    }
  }
  adapter.setVersion(getVersionIfAny(pojo));
  ensureFrameworksInAgreement(event);
}
