{
  final ObjectDataVector data=dataManager.getInstances(patternData);
  final ObjectAdapter[] instances=new ObjectAdapter[data.size()];
  int count=0;
  for (int i=0; i < data.size(); i++) {
    final ObjectData instanceData=data.element(i);
    LOG.debug("instance data " + instanceData);
    final RootOid oid=instanceData.getRootOid();
    final ObjectSpecification spec=specFor(instanceData);
    final ObjectAdapter instance=getPersistenceSession().recreateAdapter(spec,oid);
    LOG.debug("recreated instance " + instance);
    initObject(instance,instanceData);
    if (persistenceQuery == null || persistenceQuery.matches(instance)) {
      instances[count++]=instance;
    }
  }
  final ObjectAdapter[] array=new ObjectAdapter[count];
  System.arraycopy(instances,0,array,0,count);
  return array;
}
