{
  Oid oid=collection.getOid();
  String type=collection.getSpecification().getFullName();
  boolean hasAllElements=collection.getResolveState().isTransient() || collection.getResolveState().isResolved();
  ObjectData[] elements;
  if (hasAllElements) {
    Enumeration e=collection.elements();
    elements=new ObjectData[collection.size()];
    int i=0;
    while (e.hasMoreElements()) {
      NakedObject element=(NakedObject)e.nextElement();
      elements[i++]=createObjectData(element,recursePersistentObjects,graphDepth,knownObjects);
    }
  }
 else {
    elements=new ObjectData[0];
  }
  return factory.createCollectionData(oid,type,elements,hasAllElements,collection.getVersion());
}
