{
  List<FileContent> files=null;
  try {
    files=getWriteRequests(connection);
    final String error=acquireLocks(files);
    if (error == null) {
      logger.log(files);
      final DataFileWriter content=new DataFileWriter(files);
      content.writeData();
      connection.ok();
    }
 else {
      connection.error(error);
    }
  }
 catch (  final IOException e) {
    throw new NoSqlStoreException("Failed to write data",e);
  }
 finally {
    if (files != null) {
      releaseLocks(files);
    }
  }
}
