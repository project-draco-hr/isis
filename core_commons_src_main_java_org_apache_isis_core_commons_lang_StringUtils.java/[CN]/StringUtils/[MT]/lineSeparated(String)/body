{
  StringBuilder buf=new StringBuilder();
  String lineSeparator=System.getProperty("line.separator");
  boolean lastWasLineFeed=false;
  for (  char c : string.toCharArray()) {
    boolean isLineFeed=c == LINE_FEED;
    boolean isCarriageReturn=c == CARRIAGE_RETURN;
    if (isCarriageReturn) {
      buf.append(lineSeparator);
      lastWasLineFeed=false;
    }
 else {
      if (lastWasLineFeed) {
        buf.append(LINE_FEED);
      }
      if (isLineFeed) {
        lastWasLineFeed=true;
      }
 else {
        buf.append(c);
        lastWasLineFeed=false;
      }
    }
  }
  if (lastWasLineFeed) {
    buf.append(LINE_FEED);
  }
  return buf.toString();
}
