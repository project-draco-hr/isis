{
  Assert.assertNotNull("can't get an adapter for null",this,collection);
  InternalCollectionKey key=new InternalCollectionKey(parent,fieldName);
  NakedCollection adapter=(NakedCollection)pojoAdapterMap.getPojo(key);
  if (adapter == null) {
    adapter=adapterFactory.createCollectionAdapter(collection,specification);
    pojoAdapterMap.add(key,adapter);
    if (parent.getResolveState().isPersistent()) {
      LOG.debug("creating adapter for persistent collection: " + collection);
      ((AbstractNakedReference)adapter).changeState(ResolveState.GHOST);
    }
 else {
      LOG.debug("creating adapter for transient collection: " + collection);
      ((AbstractNakedReference)adapter).changeState(ResolveState.TRANSIENT);
    }
  }
  Assert.assertNotNull("should have an adapter for ",collection,adapter);
  return adapter;
}
