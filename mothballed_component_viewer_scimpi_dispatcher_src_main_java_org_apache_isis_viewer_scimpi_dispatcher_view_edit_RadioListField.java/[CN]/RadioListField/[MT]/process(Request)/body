{
  final FormFieldBlock block=(FormFieldBlock)request.getBlockContent();
  final String field=request.getRequiredProperty(FIELD);
  if (block.isVisible(field)) {
    final String id=request.getRequiredProperty(COLLECTION);
    final String exclude=request.getOptionalProperty("exclude");
    final ObjectAdapter collection=request.getContext().getMappedObjectOrResult(id);
    final RequestContext context=request.getContext();
    final CollectionFacet facet=collection.getSpecification().getFacet(CollectionFacet.class);
    final Iterator<ObjectAdapter> iterator=facet.iterator(collection);
    final StringBuffer buffer=new StringBuffer();
    while (iterator.hasNext()) {
      final ObjectAdapter element=iterator.next();
      final Scope scope=Scope.INTERACTION;
      final String elementId=context.mapObject(element,scope);
      if (exclude != null && context.getMappedObject(exclude) == element) {
        continue;
      }
      final String title=element.titleString();
      final String checked="";
      buffer.append("<input type=\"radio\" name=\"" + field + "\" value=\""+ elementId+ "\""+ checked+ " />"+ title+ "</input><br/>\n");
    }
    block.replaceContent(field,buffer.toString());
  }
}
