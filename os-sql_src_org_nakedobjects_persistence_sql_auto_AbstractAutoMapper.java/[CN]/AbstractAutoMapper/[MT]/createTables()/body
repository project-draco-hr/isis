{
  if (!db.hasTable(table)) {
    StringBuffer columns=new StringBuffer();
    TypeMapper types=TypeMapper.getInstance();
    for (int f=0; f < fields.length; f++) {
      Field field=fields[f];
      String type;
      if (field instanceof Value) {
        type=types.typeFor(fields[f].getType().getName());
        if (type == null) {
          throw new SqlObjectStoreException("No type specified for " + fields[f].getType().getName());
        }
      }
 else       if (field instanceof OneToOneAssociation) {
        type=types.id();
      }
 else {
        throw new SqlObjectStoreException("Can't map field to column: " + field);
      }
      columns.append(columnNames[f]);
      columns.append(" ");
      columns.append(type);
      columns.append(",");
    }
    columns.append(idColumn + " int");
    db.update("create table " + table + " ("+ columns+ ")");
  }
  for (int i=0; collectionMappers != null && i < collectionMappers.length; i++) {
    if (collectionMappers[i].needsTables()) {
      collectionMappers[i].createTables();
    }
  }
}
