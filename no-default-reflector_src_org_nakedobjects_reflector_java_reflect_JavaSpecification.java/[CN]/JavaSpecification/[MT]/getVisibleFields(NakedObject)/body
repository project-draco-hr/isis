{
  NakedObjectField[] viewFields=new NakedObjectField[fields.length];
  int v=0;
  for (int i=0; i < fields.length; i++) {
    boolean useField=!fields[i].isHidden() && fields[i].isAuthorised() && object.isVisible(fields[i]).isAllowed();
    if (useField) {
      viewFields[v++]=fields[i];
    }
  }
  NakedObjectField[] selectedFields=new NakedObjectField[v];
  for (int i=0; i < selectedFields.length; i++) {
    selectedFields[i]=viewFields[i];
  }
  return selectedFields;
}
