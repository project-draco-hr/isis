{
  final String[] options=field.getOptionsText();
  final String[] ids=field.getOptionValues();
  final int length=options.length;
  final String classSegment=field.isRequired() && length == 0 ? " class=\"required\"" : "";
  final String disabled=field.isEditable() ? "" : " disabled=\"disabled\"";
  final StringBuffer str=new StringBuffer();
  str.append("\n  <select name=\"" + field.getName() + "\""+ disabled+ classSegment+ ">\n");
  boolean offerOther=false;
  for (int i=0; i < length; i++) {
    final String selectedSegment=field.getValue() == null || ids[i].equals(field.getValue()) ? " selected=\"selected\"" : "";
    if (field.getType() == InputField.TEXT && options[i].equals("__other")) {
      offerOther=true;
    }
 else {
      str.append("    <option value=\"" + Request.getEncoder().encoder(ids[i]) + "\""+ selectedSegment+ ">"+ Request.getEncoder().encoder(options[i])+ "</option>\n");
    }
  }
  if (!field.isRequired() || length == 0) {
    final String selectedSegment=field.getValue() == null || field.getValue().equals("") ? " selected=\"selected\"" : "";
    str.append("    <option value=\"null\"" + selectedSegment + "></option>\n");
  }
  if (offerOther) {
    str.append("    <option value=\"-OTHER-\">Other:</option>\n");
  }
  str.append("  </select>");
  if (field.getType() == InputField.TEXT) {
    final String lengthSegment=field.getWidth() == 0 ? "" : " size=\"" + field.getWidth() + "\"";
    final String hideSegment=" style=\"display: none;\" ";
    str.append("  <input type=\"text\" name=\"" + field.getName() + "-other\""+ hideSegment+ lengthSegment+ disabled+ " />");
  }
  str.append("\n");
  return str.toString();
}
