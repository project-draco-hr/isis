{
  Color textColor;
  int baseline=getBaseline();
  if (getState().isInvalid()) {
    textColor=Style.BLACK;
  }
 else   if (hasFocus()) {
    if (isSaved) {
      textColor=Style.PRIMARY1;
    }
 else {
      textColor=Style.TEXT_EDIT;
    }
  }
 else {
    textColor=Style.BLACK;
  }
  String[] lines=textContent.getDisplayLines();
  for (int i=0; i < lines.length; i++) {
    String chars=lines[i];
    if (chars == null) {
      throw new NakedObjectRuntimeException();
    }
    if (chars.endsWith("\n")) {
      throw new RuntimeException();
    }
    if (hasFocus() && (cursor.getLine() == i) && canChangeValue()) {
      int at=Math.min(cursor.getCharacter(),chars.length());
      int pos=style.stringWidth(chars.substring(0,at));
      canvas.drawLine(pos + (HPADDING),(baseline + style.getDescent()),pos + (HPADDING),baseline - style.getAscent(),Style.PRIMARY1);
    }
    canvas.drawText(chars,HPADDING,baseline,textColor,style);
    baseline+=lineHeight();
  }
}
