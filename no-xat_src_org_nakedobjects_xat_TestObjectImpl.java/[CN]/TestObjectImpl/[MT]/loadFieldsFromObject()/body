{
  if (fields == null) {
    fields=new Hashtable();
    Naked object=getForNaked();
    if (object != null) {
      existingTestObjects.put(object,this);
      NakedObjectField[] a=object.getSpecification().getFields();
      for (int i=0; i < a.length; i++) {
        NakedObjectField att=a[i];
        if (att instanceof NakedObjectAssociation) {
          TestNaked associatedView=null;
          Naked associate;
          associate=((NakedObject)object).getField(att);
          if (att.isValue()) {
            associatedView=factory.createTestValue((NakedValue)associate);
          }
 else {
            if (associate != null) {
              associatedView=(TestObject)existingTestObjects.get(associate);
            }
            if (associatedView == null) {
              if (att.isCollection()) {
                associatedView=factory.createTestCollection((NakedCollection)associate);
              }
 else {
                associatedView=factory.createTestObject((NakedObject)associate,existingTestObjects);
              }
            }
          }
          fields.put(a[i].getName(),associatedView);
        }
      }
    }
  }
}
