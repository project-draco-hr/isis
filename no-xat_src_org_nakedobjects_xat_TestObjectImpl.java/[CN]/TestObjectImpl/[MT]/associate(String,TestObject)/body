{
  FieldSpecification field=fieldFor(fieldName);
  assertFieldVisible(fieldName,field);
  assertFieldModifiable(fieldName,field);
  if (field instanceof OneToOneAssociationSpecification) {
    assertEmpty(fieldName);
  }
  TestNaked targetField=getField(fieldName);
  if (targetField instanceof TestValue) {
    throw new IllegalActionError("drop(..) not allowed on value target field; use fieldEntry(..) instead");
  }
  if ((targetField.getForObject() != null) && !(targetField.getForObject() instanceof InternalCollection)) {
    throw new IllegalActionError("Field already contains an object: " + targetField.getForObject());
  }
  AssociationSpecification association=(AssociationSpecification)fieldFor(fieldName);
  NakedObject obj=(NakedObject)object.getForObject();
  if (association.getType() != null && !obj.getSpecification().isOfType(association.getType())) {
    throw new IllegalActionError("Can't drop a " + object.getForObject().getSpecification().getShortName() + " on to the "+ fieldName+ " field (which accepts "+ association.getType()+ ")");
  }
  NakedObject nakedObject=(NakedObject)getForObject();
  About about;
  if (association instanceof OneToOneAssociationSpecification) {
    about=((OneToOneAssociationSpecification)association).getAbout(session,nakedObject,obj);
  }
 else   if (association instanceof OneToManyAssociationSpecification) {
    about=((OneToManyAssociationSpecification)association).getAbout(session,nakedObject,obj,true);
  }
 else {
    throw new NakedObjectRuntimeException();
  }
  if (about.canAccess().isVetoed()) {
    throw new IllegalActionError("Cannot access the field " + field);
  }
  if (about.canUse().isVetoed()) {
    throw new IllegalActionError("Cannot associate " + obj + " in the field "+ field+ " within "+ nakedObject+ ": "+ about.canUse().getReason());
  }
  association.setAssociation(nakedObject,obj);
}
