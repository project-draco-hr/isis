{
  AuthenticationSession existingAuthSession=authenticationSessionLookupStrategy.lookupValid(request,response,Caching.CACHE);
  if (existingAuthSession != null) {
    redirectToStartPage(response,existingAuthSession.getUserName());
    return;
  }
  final String user=request.getParameter("username");
  final String password=request.getParameter("password");
  if (user == null && !getDeploymentType().isExploring()) {
    renderPrompt(response,"","",null);
    return;
  }
  final AuthenticationSession authSession=authenticate(user,password);
  if (authSession == null) {
    renderPrompt(response,user,password,"user/password invalid");
    return;
  }
  authenticationSessionLookupStrategy.bind(request,response,authSession,Caching.CACHE);
  final Context context=new Context(new HtmlComponentFactory(getPathBuilder()));
  context.setSession(authSession);
  authSession.setAttribute(HtmlServletConstants.AUTHENTICATION_SESSION_CONTEXT_KEY,context);
  LOG.info("created session");
  redirectToStartPage(response,user);
}
