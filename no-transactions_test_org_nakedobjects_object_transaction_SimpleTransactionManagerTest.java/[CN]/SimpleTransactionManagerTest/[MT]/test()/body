{
  NakedObjectSpecification accountClass=NakedObjectSpecificationLoader.getInstance().loadSpecification(Account.class);
  objectManager.startTransaction();
  Account personal=(Account)objectManager.createInstance(Account.class.getName());
  Account saving=(Account)objectManager.createInstance(Account.class.getName());
  personal.getName().setValue("Personal");
  personal.getBalance().setValue(1000);
  saving.getName().setValue("Savings");
  saving.getBalance().setValue(500);
  objectManager.endTransaction();
  ActionSpecification action=accountClass.getObjectAction(ActionSpecification.USER,"CreateTransactionFrom",new NakedObjectSpecification[]{accountClass});
  Transfer transfer1=(Transfer)action.execute(saving,new NakedObject[]{personal});
  transfer1.getAmount().setValue(100);
  objectManager.objectChanged(transfer1);
  ActionSpecification actionApplyFail=transfer1.getSpecification().getObjectAction(ActionSpecification.USER,"Apply But Fail");
  transfer1.execute(actionApplyFail,null);
  ActionSpecification actionApply=transfer1.getSpecification().getObjectAction(ActionSpecification.USER,"Apply");
  transfer1.execute(actionApplyFail,null);
  Transfer transfer2=(Transfer)action.execute(personal,new NakedObject[]{saving});
  transfer2.getAmount().setValue(50);
  objectManager.objectChanged(transfer2);
  actionApply=transfer2.getSpecification().getObjectAction(ActionSpecification.USER,"Apply");
  transfer2.execute(actionApply,null);
}
