{
  try {
    return (DefaultSecurityManager)SecurityUtils.getSecurityManager();
  }
 catch (  UnavailableSecurityManagerException ex) {
    String shiroIniLocation=lookupIniLocationFrom(configuration);
    Factory<SecurityManager> factory=new IniSecurityManagerFactory(shiroIniLocation);
    SecurityManager securityManager=factory.getInstance();
    SecurityUtils.setSecurityManager(securityManager);
    return securityManager;
  }
}
