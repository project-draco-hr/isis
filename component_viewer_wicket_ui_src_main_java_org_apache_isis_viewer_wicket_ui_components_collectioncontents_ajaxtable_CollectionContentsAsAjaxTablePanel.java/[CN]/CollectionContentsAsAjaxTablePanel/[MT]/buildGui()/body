{
  final List<IColumn<ObjectAdapter,String>> columns=Lists.newArrayList();
  final BulkActionsProvider bulkActionsProvider=getBulkActionsProvider();
  ObjectAdapterToggleboxColumn toggleboxColumn=null;
  if (bulkActionsProvider != null) {
    toggleboxColumn=bulkActionsProvider.createToggleboxColumn();
    if (toggleboxColumn != null) {
      columns.add(toggleboxColumn);
    }
    bulkActionsProvider.configureBulkActionsProvider(toggleboxColumn);
  }
  final EntityCollectionModel model=getModel();
  addTitleColumn(columns,model.getParentObjectAdapterMemento(),getSettings().getMaxTitleLengthInStandaloneTables(),getSettings().getMaxTitleLengthInStandaloneTables());
  addPropertyColumnsIfRequired(columns);
  final SortableDataProvider<ObjectAdapter,String> dataProvider=new CollectionContentsSortableDataProvider(model);
  dataTable=new IsisAjaxFallbackDataTable<>(ID_TABLE,columns,dataProvider,model.getPageSize());
  addOrReplace(dataTable);
  dataTable.honourHints();
  if (toggleboxColumn != null) {
    final SelectionHandler handler=new SelectionHandler(){
      private static final long serialVersionUID=1L;
      @Override public void onSelected(      final Component context,      final ObjectAdapter selectedAdapter,      final AjaxRequestTarget ajaxRequestTarget){
        model.toggleSelectionOn(selectedAdapter);
      }
      @Override public void onConcurrencyException(      final Component context,      final ObjectAdapter selectedAdapter,      final ConcurrencyException ex,      final AjaxRequestTarget ajaxRequestTarget){
        ajaxRequestTarget.add(dataTable);
      }
    }
;
    toggleboxColumn.setHandler(handler);
  }
}
