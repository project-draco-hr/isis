{
  if (LOG.isDebugEnabled()) {
    LOG.debug("compiling object data for " + adapter);
  }
  ObjectSpecification adapterSpec=adapter.getSpecification();
  ObjectData data=new ObjectData(adapterSpec,(SerialOid)adapter.getOid(),(FileVersion)adapter.getVersion());
  final List<ObjectAssociation> associations=adapterSpec.getAssociations();
  for (  ObjectAssociation association : associations) {
    if (association.isNotPersisted()) {
      continue;
    }
    final ObjectAdapter associatedObject=association.get(adapter);
    final boolean isEmpty=association.isEmpty(adapter);
    final String associationId=association.getId();
    if (association.isOneToManyAssociation()) {
      saveCollection(associationId,data,associatedObject,ensurePersistent);
    }
 else     if (association.getSpecification().isEncodeable()) {
      saveEncoded(data,associationId,associatedObject,isEmpty);
    }
 else     if (association.isOneToOneAssociation()) {
      saveReference(data,associationId,associatedObject,ensurePersistent);
    }
  }
  return data;
}
