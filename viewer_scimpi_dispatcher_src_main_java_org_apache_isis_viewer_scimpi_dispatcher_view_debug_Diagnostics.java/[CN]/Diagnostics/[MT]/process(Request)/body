{
  boolean isForced=request.isRequested("force");
  boolean isExcludeVariables=request.isRequested("exclude-variables");
  boolean isExcludeProcessing=request.isRequested("exclude-processing");
  if (isForced || request.getContext().getDebug() == RequestContext.Debug.ON) {
    RequestContext context=request.getContext();
    request.appendHtml("<div class=\"debug\">");
    request.appendHtml("<pre>");
    request.appendHtml("URI:  " + context.getUri());
    request.appendHtml("\n");
    request.appendHtml("File: " + context.fullFilePath(context.getResourceFile()));
    request.appendHtml("\n");
    AuthenticationSession session=IsisContext.getAuthenticationSession();
    request.appendHtml("Session:  " + session.getUserName() + " "+ session.getRoles());
    if (!isExcludeVariables) {
      request.appendHtml("\n\n");
      request.appendHtml("<a class=\"option\" target=\"debug\" href=\"debug.app\">Object</a>");
      context.append(request,"variables");
    }
    if (!isExcludeProcessing) {
      request.appendHtml("\n\n");
      request.appendHtml(request.getContext().getDebugTrace());
    }
    request.appendHtml("</pre>");
    request.appendHtml("</div>");
  }
}
