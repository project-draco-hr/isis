{
  final String objectId=request.getOptionalProperty(OBJECT);
  final String methodName=request.getRequiredProperty(METHOD);
  final String forwardResultTo=request.getOptionalProperty(VIEW);
  final String forwardVoidTo=request.getOptionalProperty(VOID);
  final String forwardErrorTo=request.getOptionalProperty(ERROR);
  final String variable=request.getOptionalProperty(RESULT_NAME);
  final String scope=request.getOptionalProperty(SCOPE);
  final String buttonTitle=request.getOptionalProperty(BUTTON_TITLE);
  String resultOverride=request.getOptionalProperty(RESULT_OVERRIDE);
  final String idName=request.getOptionalProperty(ID,methodName);
  final String className=request.getOptionalProperty(CLASS);
  final boolean showMessage=request.isRequested(SHOW_MESSAGE,false);
  final String completionMessage=request.getOptionalProperty(MESSAGE);
  final ObjectAdapter object=MethodsUtils.findObject(request.getContext(),objectId);
  final String version=request.getContext().mapVersion(object);
  final ObjectAction action=MethodsUtils.findAction(object,methodName);
  final ActionContent parameterBlock=new ActionContent(action);
  request.setBlockContent(parameterBlock);
  request.processUtilCloseTag();
  final String[] parameters=parameterBlock.getParameters();
  final ObjectAdapter[] objectParameters;
  final ObjectAdapter target;
  if (action.isContributed()) {
    objectParameters=null;
    System.arraycopy(parameters,0,parameters,1,parameters.length - 1);
    parameters[0]=request.getContext().mapObject(object,Scope.REQUEST);
    target=action.realTarget(object);
    if (!action.hasReturn() && resultOverride == null) {
      resultOverride=parameters[0];
    }
  }
 else {
    objectParameters=new ObjectAdapter[parameters.length];
    target=object;
    int i=0;
    for (    final ObjectActionParameter spec : action.getParameters()) {
      final ObjectSpecification type=spec.getSpecification();
      if (parameters[i] == null) {
        objectParameters[i]=null;
      }
 else       if (type.getFacet(ParseableFacet.class) != null) {
        final ParseableFacet facet=type.getFacet(ParseableFacet.class);
        Localization localization=IsisContext.getLocalization();
        objectParameters[i]=facet.parseTextEntry(null,parameters[i],localization);
      }
 else {
        objectParameters[i]=MethodsUtils.findObject(request.getContext(),parameters[i]);
      }
      i++;
    }
  }
  if (MethodsUtils.isVisibleAndUsable(object,action,where) && MethodsUtils.canRunMethod(object,action,objectParameters).isAllowed()) {
    write(request,target,action,parameters,objectId,version,forwardResultTo,forwardVoidTo,forwardErrorTo,variable,scope,buttonTitle,completionMessage,resultOverride,idName,className);
  }
  if (showMessage) {
    final Consent usable=action.isUsable(IsisContext.getAuthenticationSession(),object,where);
    if (usable.isVetoed()) {
      final String notUsable=usable.getReason();
      if (notUsable != null) {
        String title=buttonTitle == null ? action.getName() : buttonTitle;
        disabledButton(request,title,notUsable,idName,className);
      }
    }
 else {
      final Consent valid=action.isProposedArgumentSetValid(object,objectParameters);
      final String notValid=valid.getReason();
      if (notValid != null) {
        String title=buttonTitle == null ? action.getName() : buttonTitle;
        disabledButton(request,title,notValid,idName,className);
      }
    }
  }
  request.popBlockContent();
}
