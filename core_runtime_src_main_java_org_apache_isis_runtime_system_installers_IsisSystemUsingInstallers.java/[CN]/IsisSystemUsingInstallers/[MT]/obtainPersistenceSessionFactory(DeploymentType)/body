{
  String connection=getConfiguration().getString(SystemConstants.CLIENT_CONNECTION_KEY);
  if (connection != null) {
    persistenceMechanismInstaller=installerLookup.clientConnectionInstaller(connection);
  }
  if (persistenceMechanismInstaller == null) {
    String persistenceMechanism=getConfiguration().getString(SystemConstants.OBJECT_PERSISTOR_INSTALLER_KEY);
    persistenceMechanismInstaller=installerLookup.persistenceMechanismInstaller(persistenceMechanism,deploymentType);
  }
  ensureThatState(persistenceMechanismInstaller,is(not(nullValue())),"persistor installer has not been injected and could not be looked up");
  return persistenceMechanismInstaller.createPersistenceSessionFactory(deploymentType);
}
