{
  final List<Facet> filteredFacets=new ArrayList<Facet>();
  final List<Facet> allFacets=new ArrayList<Facet>(facetsByClass.values());
  for (int i=0; i < allFacets.size(); i++) {
    final Facet facet=allFacets.get(i);
    if (filter.accept(facet)) {
      filteredFacets.add(facet);
    }
  }
  return filteredFacets.toArray(new Facet[]{});
}
