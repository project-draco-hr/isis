{
  if (!isEditableWithEitherAutoCompleteOrChoices()) {
    Components.permanentlyHide(linkPanel,ReferencePanel.ID_AUTO_COMPLETE);
    linkPanel.select2Field=null;
    return;
  }
  final IModel<ObjectAdapterMemento> model=Util.createModel(getModel().asScalarModelWithPending());
  if (linkPanel.select2Field == null) {
    linkPanel.setRequired(getModel().isRequired());
    linkPanel.select2Field=Select2ChoiceUtil.newSelect2Choice(ReferencePanel.ID_AUTO_COMPLETE,model,getModel());
    setProviderAndCurrAndPending(linkPanel.select2Field,getModel().getActionArgsHint());
    if (!getModel().hasChoices()) {
      final Settings settings=linkPanel.select2Field.getSettings();
      final int minLength=getModel().getAutoCompleteMinLength();
      settings.setMinimumInputLength(minLength);
      settings.setPlaceholder(getModel().getName());
    }
    linkPanel.addOrReplace(linkPanel.select2Field);
  }
 else {
    linkPanel.select2Field.clearInput();
  }
  if (labelIfRegular != null) {
    Components.permanentlyHide(labelIfRegular,ReferencePanel.ID_ENTITY_ICON_AND_TITLE);
  }
}
