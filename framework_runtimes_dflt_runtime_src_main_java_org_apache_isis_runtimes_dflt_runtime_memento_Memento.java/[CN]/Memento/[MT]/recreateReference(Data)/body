{
  final ObjectSpecification spec=getSpecificationLoader().loadSpecification(data.getClassName());
  if (data instanceof StandaloneData) {
    final StandaloneData standaloneData=(StandaloneData)data;
    return standaloneData.getAdapter();
  }
 else {
    final Oid oid=data.getOid();
    if (oid == null) {
      return null;
    }
    ObjectAdapter ref;
    ref=getHydrator().recreateAdapter(oid,spec);
    if (data instanceof ObjectData) {
      if (oid.isTransient() || spec.isParented()) {
        final ResolveState resolveState=spec.isParented() ? ResolveState.GHOST : ResolveState.TRANSIENT;
        if (ref.getResolveState().isValidToChangeTo(resolveState)) {
          ref.changeState(resolveState);
        }
        updateObject(ref,data,resolveState);
      }
    }
    return ref;
  }
}
