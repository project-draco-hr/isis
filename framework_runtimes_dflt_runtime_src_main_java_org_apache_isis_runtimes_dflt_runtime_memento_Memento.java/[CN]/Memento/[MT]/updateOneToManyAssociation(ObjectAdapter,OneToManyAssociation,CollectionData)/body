{
  final ObjectAdapter collection=field.get(object);
  final CollectionFacet facet=CollectionFacetUtils.getCollectionFacetFromSpec(collection);
  final List<ObjectAdapter> original=Lists.newArrayList();
  for (  final ObjectAdapter adapter : facet.iterable(collection)) {
    original.add(adapter);
  }
  final Data[] elements=collectionData.elements;
  for (  final Data data : elements) {
    final ObjectAdapter element=recreateReference(data);
    if (!facet.contains(collection,element)) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("  association " + field + " changed, added "+ element.getOid());
      }
      field.addElement(object,element);
    }
 else {
      field.removeElement(object,element);
    }
  }
  for (  final ObjectAdapter element : original) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("  association " + field + " changed, removed "+ element.getOid());
    }
    field.removeElement(object,element);
  }
}
