{
  String updateWhereClause=updateWhereClause(object,true);
  object.setOptimisticLock(0,"",new Date());
  StringBuffer assignments=new StringBuffer();
  int fld=0;
  for (int i=0; i < oneToOnefields.length; i++) {
    Naked fieldValue=object.getField(oneToOnefields[i]);
    if (i > 0) {
      assignments.append(", ");
    }
    assignments.append(quote(columnNames[fld++]));
    assignments.append('=');
    if (fieldValue instanceof NakedObject) {
      if (fieldValue == null) {
        assignments.append("NULL");
      }
 else {
        Object oid=((NakedObject)fieldValue).getOid();
        assignments.append(primaryKey(oid));
      }
    }
 else     if (fieldValue instanceof NakedValue) {
      ValueMapper mapper=typeMapper.mapperFor(oneToOnefields[i].getSpecification());
      assignments.append(mapper.valueAsDBString((NakedValue)fieldValue));
    }
 else {
      assignments.append("NULL");
    }
  }
  String id=primaryKey(object.getOid());
  String statement="update " + quote(table) + " set "+ assignments+ " where "+ quote(idColumn)+ "="+ id+ " and \"version\" = "+ object.getVersion()+ updateWhereClause;
  int updateCount=connector.update(statement);
  if (updateCount == 0) {
    throw new NakedObjectRuntimeException(new NakedObjectRuntimeException("No update: " + statement));
  }
  for (int i=0; i < collectionMappers.length; i++) {
    collectionMappers[i].saveInternalCollection(connector,object);
  }
}
