{
  if (LOG.isDebugEnabled()) {
    LOG.debug("getInstances matching " + persistenceQuery);
  }
  final PersistenceQueryProcessor<? extends PersistenceQuery> processor=PersistenceSession.this.persistenceQueryProcessorByClass.get(persistenceQuery.getClass());
  if (processor == null) {
    throw new UnsupportedFindException(MessageFormat.format("Unsupported criteria type: {0}",persistenceQuery.getClass().getName()));
  }
  final List<ObjectAdapter> instances=getTransactionManager().executeWithinTransaction(new TransactionalClosureWithReturn<List<ObjectAdapter>>(){
    @Override public List<ObjectAdapter> execute(){
      return processPersistenceQuery(processor,persistenceQuery);
    }
  }
);
  final ObjectSpecification specification=persistenceQuery.getSpecification();
  final FreeStandingList results=new FreeStandingList(specification,instances);
  return getAdapterManager().adapterFor(results);
}
