{
  ensureNotOpened();
  if (LOG.isDebugEnabled()) {
    LOG.debug("opening " + this);
  }
  getOidAdapterMap().open();
  getPojoAdapterMap().open();
  persistenceManager=applicationComponents.getPersistenceManagerFactory().getPersistenceManager();
  final IsisLifecycleListener2 isisLifecycleListener=new IsisLifecycleListener2(this);
  persistenceManager.addInstanceLifecycleListener(isisLifecycleListener,(Class[])null);
  persistenceQueryProcessorByClass.put(PersistenceQueryFindAllInstances.class,new PersistenceQueryFindAllInstancesProcessor(this));
  persistenceQueryProcessorByClass.put(PersistenceQueryFindUsingApplibQueryDefault.class,new PersistenceQueryFindUsingApplibQueryProcessor(this));
  initServices();
  setState(State.OPEN);
}
