{
  ensureRootObject(pojo);
  if (!pojo.dnIsPersistent()) {
    throw new IllegalStateException("Pojo JDO state is not persistent! pojo dnOid: " + JDOHelper.getObjectId(pojo));
  }
  final ObjectAdapter adapter=getAdapterFor(pojo);
  final RootOid isisOid=(RootOid)adapter.getOid();
  if (isisOid.isTransient()) {
    final RootOid persistentOid=createPersistentOrViewModelOid(pojo);
    remapAsPersistent(adapter,persistentOid);
    CallbackFacet.Util.callCallback(adapter,PersistedCallbackFacet.class);
    final IsisTransaction transaction=getCurrentTransaction();
    transaction.enlistCreated(adapter);
  }
 else {
    CallbackFacet.Util.callCallback(adapter,UpdatedCallbackFacet.class);
  }
  Version versionIfAny=getVersionIfAny(pojo);
  adapter.setVersion(versionIfAny);
}
