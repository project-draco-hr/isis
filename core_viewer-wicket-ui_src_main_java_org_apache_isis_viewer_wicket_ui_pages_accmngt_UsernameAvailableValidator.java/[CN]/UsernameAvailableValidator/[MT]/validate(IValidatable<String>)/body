{
  IsisContext.getSessionFactory().doInSession(new Runnable(){
    @Override public void run(){
      UserRegistrationService userRegistrationService=IsisContext.getSessionFactory().getCurrentSession().getPersistenceSession().getServicesInjector().lookupServiceElseFail(UserRegistrationService.class);
      String username=validatable.getValue();
      boolean usernameExists=userRegistrationService.usernameExists(username);
      if (usernameExists) {
        validatable.error(new ValidationError().addKey("usernameIsNotAvailable"));
      }
    }
  }
);
}
