{
  final TestProxyAdapter object=new TestProxyAdapter();
  object.setupOid(new TestProxyOid(5));
  object.setupResolveState(ResolveState.GHOST);
  final IdentityData identityData=new DummyReferenceData();
  final ObjectData objectData=new DummyObjectData();
  final ResolveObjectRequest request=new ResolveObjectRequest(session,identityData);
  mockery.checking(new Expectations(){
{
      one(mockEncoder).encodeIdentityData(object);
      will(returnValue(identityData));
      one(mockDistribution).resolveImmediately(request);
      will(returnValue(objectData));
      one(mockEncoder).decode(objectData);
      will(returnValue(null));
    }
  }
);
  persistenceSessionProxy.resolveImmediately(object);
}
