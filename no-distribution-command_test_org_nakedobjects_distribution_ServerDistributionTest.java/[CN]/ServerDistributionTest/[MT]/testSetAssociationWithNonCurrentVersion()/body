{
  Movie movie=new Movie();
  NakedObject movieAdapter=loader.createAdapterForTransient(movie);
  movieAdapter.persistedAs(new DummyOid(1));
  Person person=new Person();
  NakedObject personAdapter=loader.createAdapterForTransient(person);
  personAdapter.persistedAs(new DummyOid(3));
  persistor.setupAddObject(movieAdapter);
  persistor.setupAddObject(personAdapter);
  DummyReferenceData movieData=new DummyReferenceData(new DummyOid(1),Movie.class.getName(),new DummyVersion(2));
  DummyReferenceData personData=new DummyReferenceData(new DummyOid(3),Person.class.getName(),new DummyVersion(4));
  movieAdapter.setOptimisticLock(new DummyVersion(1));
  personAdapter.setOptimisticLock(new DummyVersion(4));
  try {
    distribution.setAssociation(session,"director",movieData,personData);
    fail();
  }
 catch (  ConcurrencyException expected) {
  }
  movieAdapter.setOptimisticLock(new DummyVersion(2));
  personAdapter.setOptimisticLock(new DummyVersion(3));
  try {
    distribution.setAssociation(session,"director",movieData,personData);
    fail();
  }
 catch (  ConcurrencyException expected) {
  }
}
