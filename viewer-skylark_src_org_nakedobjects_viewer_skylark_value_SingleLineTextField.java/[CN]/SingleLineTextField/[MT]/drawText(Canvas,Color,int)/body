{
  String[] lines=textContent.getDisplayLines();
  if (lines.length > 1) {
    throw new NakedObjectRuntimeException("Single line text field should contain a string that contains no line breaks; contains " + lines.length);
  }
  String chars=lines[0];
  if (chars == null) {
    throw new NakedObjectRuntimeException();
  }
  if (chars.endsWith("\n")) {
    throw new RuntimeException();
  }
  int baseline=getBaseline();
  if (hasFocus() && canChangeValue()) {
    int at=Math.min(cursor.getCharacter(),chars.length());
    int pos=style.stringWidth(chars.substring(0,at)) - offset;
    canvas.drawLine(pos + 1,(baseline + style.getDescent()),pos + 1,baseline - style.getAscent(),Style.PRIMARY1);
  }
  canvas.drawText(chars,HPADDING - offset,baseline,textColor,style);
  baseline+=getText().getLineHeight();
}
