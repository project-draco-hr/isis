{
  NakedObjectSpecification cls=object.getSpecification();
  ObjectData d=new ObjectData(object.getOid(),cls.getFullName());
  FieldSpecification[] fields=cls.getFields();
  for (int i=0; i < fields.length; i++) {
    FieldSpecification field=fields[i];
    if (!field.isDerived()) {
      if (field instanceof ValueFieldSpecification) {
        NakedValue v=(NakedValue)field.get(object);
        d.addField(field.getName(),v.isEmpty() ? null : v.saveString());
      }
 else       if (field instanceof OneToManyAssociationSpecification) {
        InternalCollection coll=(InternalCollection)field.get(object);
        d.addField(field.getName(),createData(coll));
      }
 else       if (field instanceof OneToOneAssociationSpecification) {
        NakedObject ref=(NakedObject)field.get(object);
        Object refOid=ref == null ? null : new Data(ref.getOid(),ref.getSpecification().getFullName());
        d.addField(field.getName(),refOid);
      }
    }
  }
  return d;
}
