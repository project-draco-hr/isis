{
  final CssClassFacet facet=association.getFacet(CssClassFacet.class);
  if (facet != null) {
    final ObjectAdapter objectAdapter=entityModel.getObject();
    final String cssClass=facet.cssClass(objectAdapter);
    CssClassAppender.appendCssClassTo(collectionRvContainer,cssClass);
  }
  final WebMarkupContainer fieldset=new WebMarkupContainer(ID_COLLECTION_GROUP);
  collectionRvContainer.add(fieldset);
  final OneToManyAssociation otma=(OneToManyAssociation)association;
  final CollectionPanel collectionPanel=new CollectionPanel(ID_COLLECTION,entityModel,otma);
  fieldset.addOrReplace(collectionPanel);
  Label labelComponent=collectionPanel.createLabel(ID_COLLECTION_NAME,association.getName());
  final NamedFacet namedFacet=association.getFacet(NamedFacet.class);
  labelComponent.setEscapeModelStrings(namedFacet == null || namedFacet.escaped());
  final String description=association.getDescription();
  if (description != null) {
    labelComponent.add(new AttributeAppender("title",Model.of(description)));
  }
  fieldset.add(labelComponent);
  final EntityCollectionModel entityCollectionModel=collectionPanel.getModel();
  List<LinkAndLabel> links=entityCollectionModel.getLinks();
  AdditionalLinksPanel.addAdditionalLinks(fieldset,ID_ADDITIONAL_LINKS,links,AdditionalLinksPanel.Style.INLINE_LIST);
  final CollectionSelectorHelper selectorHelper=new CollectionSelectorHelper(entityCollectionModel,getComponentFactoryRegistry());
  final List<ComponentFactory> componentFactories=selectorHelper.getComponentFactories();
  if (componentFactories.size() <= 1) {
    permanentlyHide(ID_SELECTOR_DROPDOWN);
  }
 else {
    CollectionSelectorPanel selectorDropdownPanel;
    selectorDropdownPanel=new CollectionSelectorPanel(ID_SELECTOR_DROPDOWN,entityCollectionModel);
    final Model<ComponentFactory> componentFactoryModel=new Model<>();
    final int selected=selectorHelper.honourViewHintElseDefault(selectorDropdownPanel);
    ComponentFactory selectedComponentFactory=componentFactories.get(selected);
    componentFactoryModel.setObject(selectedComponentFactory);
    this.setOutputMarkupId(true);
    fieldset.addOrReplace(selectorDropdownPanel);
    collectionPanel.setSelectorDropdownPanel(selectorDropdownPanel);
  }
}
