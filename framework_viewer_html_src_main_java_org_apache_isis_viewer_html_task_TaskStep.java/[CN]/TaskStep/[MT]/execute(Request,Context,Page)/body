{
  final String taskId=request.getTaskId();
  final Task task=context.getTask(taskId);
  final String button=request.getButtonName();
  if (task == null && !"Cancel".equals(button)) {
    throw new TaskLookupException("No task found with id " + taskId);
  }
  if (button == null) {
    displayTask(context,page,task);
  }
 else   if ("Cancel".equals(button)) {
    forwardCancel(request,context,task);
  }
 else   if ("Previous".equals(button)) {
    task.setFromFields(request,context);
    task.previousStep();
    displayTask(context,page,task);
  }
 else   if ("Next".equals(button)) {
    task.setFromFields(request,context);
    task.nextStep();
    displayTask(context,page,task);
  }
 else   if ("Finish".equals(button) || "Save".equals(button) || "Ok".equals(button)) {
    task.setFromFields(request,context);
    task.checkForValidity(context);
    if (hasErrors(task)) {
      displayTask(context,page,task);
    }
 else {
      final String targetId=context.mapObject(task.getTarget(context));
      final ObjectAdapter result=task.completeTask(context,page);
      if (result instanceof ObjectAdapter) {
        final ObjectAdapter object=result;
        context.updateVersion(object);
      }
      InvokeMethod.displayMethodResult(request,context,page,result,targetId);
      context.endTask(task);
    }
  }
 else {
    throw new ActionException("No task action: " + button);
  }
}
