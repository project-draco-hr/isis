{
  BasicConfigurator.configure();
  int port;
  String directoryPath;
  String fileName;
  String extension;
  PropertiesFileLoader loader=new PropertiesFileLoader("nakedobjects.properties",true);
  PropertiesConfiguration c=new PropertiesConfiguration(loader);
  String prefix="nakedobjects.snapshotserver.";
  port=c.getInteger(prefix + "port",9289);
  directoryPath=c.getString(prefix + "directory",".");
  fileName=c.getString(prefix + "filename","log");
  extension=c.getString(prefix + "extension","txt");
  ServerSocket server;
  try {
    server=new ServerSocket(port);
  }
 catch (  IOException e) {
    LOG.error("failed to start server",e);
    return;
  }
  while (true) {
    try {
      Socket s=server.accept();
      LOG.info("receiving log from " + s.getInetAddress().getHostName());
      BufferedReader in=new BufferedReader(new InputStreamReader(s.getInputStream(),"8859_1"));
      String message=in.readLine();
      SnapshotWriter w=new SnapshotWriter(directoryPath,fileName,extension,message);
      String line;
      while ((line=in.readLine()) != null) {
        w.appendLog(line);
      }
      s.close();
      in.close();
    }
 catch (    IOException e) {
      LOG.error("failed to log",e);
    }
  }
}
