{
  Exception cause=new Exception("barfoo");
  JsonApplicationException ex=JsonApplicationException.create(HttpStatusCode.BAD_REQUEST,"foobar",cause);
  Response response=exceptionMapper.toResponse(ex);
  String entity=(String)response.getEntity();
  assertThat(entity,is(not(nullValue())));
  JsonRepresentation jsonRepr=JsonMapper.instance().read(entity,JsonRepresentation.class);
  assertThat(jsonRepr.getString("message"),is(ex.getMessage()));
  JsonRepresentation causedByRepr=jsonRepr.getRepresentation("causedBy");
  assertThat(causedByRepr,is(not(nullValue())));
  assertThat(causedByRepr.getString("message"),is(cause.getMessage()));
}
