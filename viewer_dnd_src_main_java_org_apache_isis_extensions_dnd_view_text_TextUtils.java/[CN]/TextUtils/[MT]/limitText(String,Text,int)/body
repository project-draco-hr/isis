{
  String text=xtext;
  int ellipsisWidth=style.stringWidth("...");
  if (maxWidth > 0 && style.stringWidth(text) > maxWidth) {
    int lastCharacterWithinAllowedWidth=0;
    for (int textWidth=ellipsisWidth; textWidth <= maxWidth; ) {
      final char character=text.charAt(lastCharacterWithinAllowedWidth);
      textWidth+=style.charWidth(character);
      lastCharacterWithinAllowedWidth++;
    }
    int space=text.lastIndexOf(' ',lastCharacterWithinAllowedWidth - 1);
    if (space > 0) {
      while (space >= 0) {
        final char character=text.charAt(space - 1);
        if (Character.isLetterOrDigit(character)) {
          break;
        }
        space--;
      }
      text=text.substring(0,space);
    }
 else {
      if (lastCharacterWithinAllowedWidth > 0) {
        text=text.substring(0,lastCharacterWithinAllowedWidth - 1);
      }
 else {
        text="";
      }
    }
    text+="...";
  }
  return text;
}
