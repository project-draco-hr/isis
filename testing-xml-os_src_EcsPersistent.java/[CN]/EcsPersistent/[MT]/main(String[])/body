{
  BasicConfigurator.configure();
  Configuration configuration=new Configuration(new ConfigurationPropertiesLoader(DEFAULT_CONFIG,false));
  if (configuration.getString(SHOW_EXPLORATION_OPTIONS) == null) {
    configuration.add(SHOW_EXPLORATION_OPTIONS,"yes");
  }
  NakedObjectsClient nakedObjects=new NakedObjectsClient();
  nakedObjects.setConfiguration(configuration);
  PropertyConfigurator.configure(configuration.getProperties("log4j"));
  AboutNakedObjects.logVersion();
  SplashWindow splash=null;
  boolean noSplash=configuration.getBoolean("nosplash",false);
  if (!noSplash) {
    splash=new SplashWindow();
  }
  try {
    JavaBusinessObjectContainer container=new JavaBusinessObjectContainer();
    JavaObjectFactory objectFactory=new JavaObjectFactory();
    objectFactory.setContainer(container);
    XmlObjectStore objectStore=new XmlObjectStore();
    objectStore.setDataManager(new XmlDataManager());
    OidGenerator oidGenerator=new SimpleOidGenerator();
    LocalObjectManager objectManager=new LocalObjectManager();
    objectManager.setObjectStore(objectStore);
    objectManager.setObjectFactory(objectFactory);
    objectManager.setOidGenerator(oidGenerator);
    objectManager.setCheckObjectsForDirtyFlag(true);
    nakedObjects.setObjectManager(objectManager);
    NakedObjectSpecificationLoaderImpl specificationLoader=new NakedObjectSpecificationLoaderImpl();
    nakedObjects.setSpecificationLoader(specificationLoader);
    LocalReflectionFactory reflectionFactory=new LocalReflectionFactory();
    JavaReflectorFactory reflectorFactory=new JavaReflectorFactory();
    nakedObjects.setReflectionFactory(reflectionFactory);
    nakedObjects.setReflectorFactory(reflectorFactory);
    reflectorFactory.setObjectFactory(objectFactory);
    new SystemClock();
    nakedObjects.setSession(new SimpleSession());
    objectManager.setReflectorFactory(reflectorFactory);
    objectManager.init();
    SkylarkViewer viewer=new SkylarkViewer();
    viewer.setUpdateNotifier(new ViewUpdateNotifier());
    Context ecs=new Context();
    viewer.setApplication(ecs);
    viewer.setExploration(true);
    viewer.setShutdownListener(new ObjectViewingMechanismListener(){
      public void viewerClosing(){
        System.out.println("EXITED");
        System.exit(0);
      }
    }
);
    viewer.init();
  }
  finally {
    if (splash != null) {
      splash.toFront();
      splash.removeAfterDelay(3);
    }
  }
}
