{
  if (objectId == null) {
    objectId=context.getStringVariable(RequestContext.RESULT);
  }
  if (objectId != null && objectId.startsWith(SERVICE_PREFIX)) {
    final String serviceId=objectId.substring(SERVICE_PREFIX.length());
    final List<ObjectAdapter> serviceAdapters=getPersistenceSession().getServices();
    for (    final ObjectAdapter serviceAdapter : serviceAdapters) {
      final Object service=serviceAdapter.getObject();
      if (ServiceUtil.id(service).equals(serviceId.trim())) {
        final ObjectAdapter adapter=getAdapterManager().getAdapterFor(service);
        return adapter;
      }
    }
    throw new DispatchException("Failed to find service " + serviceId);
  }
 else {
    return context.getMappedObject(objectId);
  }
}
