{
  Assert.assertEquals(view.getView(),view);
  Content content=view.getContent();
  OneToManyAssociationSpecification field=(OneToManyAssociationSpecification)(content instanceof OneToManyField ? ((OneToManyField)content).getField() : null);
  LOG.debug("rebuild view " + view + " for "+ content);
  CollectionContent collectionContent=((CollectionContent)content);
  Enumeration elements;
  if (showAll) {
    elements=collectionContent.allElements();
  }
 else {
    CollectionDisplayIterator iterator=collectionContent.getIterator();
    elements=iterator.displayElements();
  }
  View[] subviews=view.getSubviews();
  NakedObject[] existingElements=new NakedObject[subviews.length];
  for (int i=0; i < subviews.length; i++) {
    view.removeView(subviews[i]);
    existingElements[i]=((ObjectContent)subviews[i].getContent()).getObject();
  }
  while (elements.hasMoreElements()) {
    NakedObject element=(NakedObject)elements.nextElement();
    View elementView=null;
    for (int i=0; i < subviews.length; i++) {
      if (existingElements[i] == element) {
        elementView=subviews[i];
        break;
      }
    }
    if (elementView == null) {
      Content elementContent;
      if (field == null) {
        elementContent=new CollectionElement(element);
      }
 else {
        NakedObject parent=((OneToManyField)content).getParent();
        elementContent=new OneToManyFieldElement(parent,element,field);
      }
      elementView=subviewDesign.createSubview(elementContent,view.getViewAxis());
    }
    view.addView(elementView);
  }
}
