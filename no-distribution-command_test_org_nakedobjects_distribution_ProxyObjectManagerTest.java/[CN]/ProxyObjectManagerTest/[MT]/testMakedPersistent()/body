{
  TestObjectBuilder referencedObject;
  referencedObject=new TestObjectBuilder(new TestPojo());
  referencedObject.setResolveState(ResolveState.TRANSIENT);
  TestValue value=new TestValue(new TestPojoValuePeer());
  TestObjectBuilder obj;
  obj=new TestObjectBuilder(new TestPojo());
  obj.setResolveState(ResolveState.TRANSIENT);
  obj.setValueField("value",value);
  obj.setReferenceField("reference",referencedObject);
  obj.init(system);
  ObjectData field2=new DummyObjectData(new DummyOid(345),"type",true,new DummyVersion(456));
  field2.setFieldContent(new Data[]{});
  DummyObjectData dummyObjectData=new DummyObjectData(new DummyOid(123),"type",true,new DummyVersion(456));
  dummyObjectData.setFieldContent(new Data[]{null,field2});
  distribution.setupMakePersistentResults(dummyObjectData);
  NakedObject transientObject=obj.getAdapter();
  NakedObjects.getObjectPersistor().makePersistent(transientObject);
  assertEquals(new DummyOid(123),transientObject.getOid());
  assertEquals(new DummyOid(345),referencedObject.getAdapter().getOid());
}
