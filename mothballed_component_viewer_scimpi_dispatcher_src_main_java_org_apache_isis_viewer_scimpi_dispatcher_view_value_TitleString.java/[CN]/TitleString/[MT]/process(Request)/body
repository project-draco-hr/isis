{
  final String id=request.getOptionalProperty(OBJECT);
  final String fieldName=request.getOptionalProperty(FIELD);
  final int truncateTo=Integer.valueOf(request.getOptionalProperty(TRUNCATE,"0")).intValue();
  final ObjectAdapter object=request.getContext().getMappedObjectOrResult(id);
  if (object == null) {
    return;
  }
  String titleString;
  if (fieldName == null) {
    titleString=object.titleString();
  }
 else {
    final ObjectAssociation field=object.getSpecification().getAssociation(fieldName);
    if (field.isVisible(IsisContext.getAuthenticationSession(),object,Where.ANYWHERE).isVetoed()) {
      throw new ForbiddenException(field,ForbiddenException.VISIBLE);
    }
    final ObjectAdapter fieldReference=field.get(object);
    if (fieldReference != null) {
      titleString=fieldReference.titleString();
    }
 else {
      titleString="";
    }
  }
  request.appendDebug("    " + titleString);
  request.appendTruncated(titleString,truncateTo);
}
