{
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  ObjectOutputStream oos=new ObjectOutputStream(baos);
  ins.saveData(oos);
  oos.close();
  byte[] buffer=baos.toByteArray();
  ByteArrayInputStream bais=new ByteArrayInputStream(buffer);
  ObjectInputStream ois=new ObjectInputStream(bais);
  MockObjectManager manager=MockObjectManager.setup();
  NakedObjectSpecification personClass=NakedObjectSpecificationLoader.getInstance().loadSpecification(Person.class);
  MockLoadedObjects loadedWithOids=new MockLoadedObjects();
  Person p1r=new Person();
  p1r.setOid(p1.getOid());
  Person p2r=new Person();
  p2r.setOid(p2.getOid());
  loadedWithOids.setupLoadedObjects(new NakedObject[]{p1r,p2r});
  Instances ins2=new Instances(personClass,loadedWithOids);
  assertEquals(2,ins2.loadData(ois,manager.getContext()));
  ois.close();
  assertEquals("this method does not load up the instances",0,ins2.numberInstances());
  assertEquals(p1,p1r);
  assertFalse(p1 == p1r);
  assertEquals(p1.getName(),p1r.getName());
  assertEquals(p1.getSalary(),p1r.getSalary());
  assertEquals(p2,p2r);
  assertFalse(p2 == p2r);
  assertEquals(p2.getName(),p2r.getName());
  assertEquals(p2.getSalary(),p2r.getSalary());
}
