{
  LoadedObjects loaded=new MockLoadedObjects();
  NakedObjectSpecification nc=NakedObjects.getSpecificationLoader().loadSpecification(Person.class);
  ins=new Instances(nc,loaded);
  Role r=new Role();
  r.setReferencedObject(p1);
  r.setupOid(new SerialOid(6));
  ins.create(r);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  ObjectOutputStream oos=new ObjectOutputStream(baos);
  ins.saveData(oos);
  oos.close();
  byte[] buffer=baos.toByteArray();
  ByteArrayInputStream bais=new ByteArrayInputStream(buffer);
  ObjectInputStream ois=new ObjectInputStream(bais);
  MockObjectManager manager=MockObjectManager.setup();
  NakedObjectSpecification roleClass=NakedObjects.getSpecificationLoader().loadSpecification(Person.class);
  MockLoadedObjects loadedWithOids=new MockLoadedObjects();
  Person p1r=new Person();
  p1r.setupOid(p1.getOid());
  Person p2r=new Person();
  p2r.setupOid(p2.getOid());
  Role r1r=new Role();
  r1r.setupOid(r.getOid());
  loadedWithOids.setupLoadedObjects(new NakedObject[]{r1r,p1r,p2r});
  Instances ins2=new Instances(roleClass,loadedWithOids);
  assertEquals(1,ins2.loadData(ois,manager.getContext()));
  ois.close();
}
