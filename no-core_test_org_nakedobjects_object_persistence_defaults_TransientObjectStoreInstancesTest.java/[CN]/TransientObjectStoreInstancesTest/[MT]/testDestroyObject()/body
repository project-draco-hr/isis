{
  NakedObject object=createTestObject();
  NakedObject objectToDelete=createTestObject();
  PersistenceCommand[] commands=new PersistenceCommand[]{objectStore.createCreateObjectCommand(objectToDelete),objectStore.createCreateObjectCommand(object)};
  objectStore.runTransaction(commands);
  loadedObjects.loaded(objectToDelete);
  commands=new PersistenceCommand[]{objectStore.createDestroyObjectCommand(objectToDelete)};
  objectStore.runTransaction(commands);
  restartObjectStore();
  NakedObject[] v=objectStore.getInstances(objectSpec,false);
  assertEquals(1,v.length);
  assertEquals(object,v[0]);
}
