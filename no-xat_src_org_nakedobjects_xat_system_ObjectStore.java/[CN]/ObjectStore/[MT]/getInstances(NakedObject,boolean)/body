{
  if (pattern == null) {
    throw new NullPointerException();
  }
  Vector instances=new Vector();
  if (pattern instanceof NakedClass) {
    NakedObjectSpecification forNakedClass=((NakedClass)pattern).forNakedClass();
    Enumeration objects=elements(forNakedClass);
    String name=forNakedClass.getFullName();
    while (objects.hasMoreElements()) {
      NakedObject object=(NakedObject)objects.nextElement();
      if (object instanceof NakedClass && ((NakedClass)object).getName().isSameAs(name)) {
        instances.addElement(object);
      }
    }
  }
 else {
    NakedObjectSpecification requiredType=pattern.getSpecification();
    Enumeration objects=elements(requiredType);
    while (objects.hasMoreElements()) {
      NakedObject object=(NakedObject)objects.nextElement();
      if (requiredType.equals(object.getSpecification()) && matchesPattern(pattern,object)) {
        instances.addElement(object);
      }
    }
  }
  LOG.debug("getInstances like " + pattern + " => "+ instances);
  return toInstancesArray(instances);
}
