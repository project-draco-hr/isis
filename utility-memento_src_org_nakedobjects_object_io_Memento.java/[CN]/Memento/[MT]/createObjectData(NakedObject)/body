{
  NakedObjectSpecification cls=object.getSpecification();
  ObjectData d=new ObjectData(object.getOid(),object.getResolveState().name(),cls.getFullName());
  NakedObjectField[] fields=cls.getFields();
  for (int i=0; i < fields.length; i++) {
    NakedObjectField field=fields[i];
    if (!field.isDerived()) {
      if (field.isCollection()) {
        InternalCollection coll=(InternalCollection)object.getField(field);
        d.addField(field.getName(),createData(coll));
      }
 else       if (field.isObject()) {
        NakedObject ref=object.getAssociation((OneToOneAssociation)field);
        Object refOid=ref == null ? null : new Data(ref.getOid(),ref.getResolveState().name(),ref.getSpecification().getFullName());
        d.addField(field.getName(),refOid);
      }
 else       if (field.isValue()) {
        NakedValue value=object.getValue((OneToOneAssociation)field);
        d.addField(field.getName(),value.asEncodedString());
      }
    }
  }
  return d;
}
