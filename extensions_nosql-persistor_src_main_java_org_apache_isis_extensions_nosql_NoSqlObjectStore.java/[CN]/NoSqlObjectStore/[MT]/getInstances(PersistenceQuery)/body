{
  String specificationName=persistenceQuery.getSpecification().getFullName();
  Iterator<StateReader> instanceData=database.instancesOf(specificationName);
  List<ObjectAdapter> instances=new ArrayList<ObjectAdapter>();
  while (instanceData.hasNext()) {
    StateReader reader=instanceData.next();
    ObjectAdapter instance=objectReader.load(reader,keyCreator,versionCreator);
    if (persistenceQuery instanceof PersistenceQueryBuiltIn) {
      if (!((PersistenceQueryBuiltIn)persistenceQuery).matches(instance)) {
        continue;
      }
    }
    instances.add(instance);
  }
  return instances.toArray(new ObjectAdapter[instances.size()]);
}
