{
  final boolean initiallyInTransaction=inTransaction();
  if (!initiallyInTransaction) {
    startTransaction();
  }
  try {
    closure.preExecute();
    final Q retVal=closure.execute();
    closure.onSuccess();
    if (!initiallyInTransaction) {
      endTransaction();
    }
    return retVal;
  }
 catch (  final RuntimeException ex) {
    closure.onFailure();
    if (!initiallyInTransaction) {
      abortTransaction();
    }
 else {
      getTransaction().setAbortCause(new IsisException(ex));
    }
    throw ex;
  }
}
