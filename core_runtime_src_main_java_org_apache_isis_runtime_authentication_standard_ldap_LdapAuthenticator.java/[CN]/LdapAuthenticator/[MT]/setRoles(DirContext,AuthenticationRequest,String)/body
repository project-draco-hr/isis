{
  final List<String> roles=new ArrayList<String>();
  final SearchControls controls=new SearchControls();
  controls.setSearchScope(SearchControls.SUBTREE_SCOPE);
  controls.setReturningAttributes(new String[]{"cn"});
  final String name="uid=" + username + ", "+ ldapDn;
  final NamingEnumeration<SearchResult> answer=authContext.search(name,LdapAuthenticationConstants.FILTER,controls);
  while (answer.hasMore()) {
    final SearchResult result=(SearchResult)answer.nextElement();
    final String roleName=(String)result.getAttributes().get("cn").get(0);
    roles.add(roleName);
    LOG.debug("Adding role: " + roleName);
  }
  request.setRoles(roles);
}
