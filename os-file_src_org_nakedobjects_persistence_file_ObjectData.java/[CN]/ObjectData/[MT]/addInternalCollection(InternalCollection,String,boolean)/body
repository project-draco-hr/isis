{
  if (ensurePersistent && collection != null && collection.getOid() == null) {
    throw new IllegalStateException("Cannot save a collection that is not persistent");
  }
  SerialOid coid=(SerialOid)collection.getOid();
  initCollection(coid,fieldName);
  int size=collection.size();
  for (int i=0; i < size; i++) {
    NakedObject element=collection.elementAt(i);
    Object elementOid=element.getOid();
    if (elementOid == null) {
      throw new IllegalStateException("Element is not persistent " + element);
    }
    addElement(fieldName,(SerialOid)elementOid);
  }
}
