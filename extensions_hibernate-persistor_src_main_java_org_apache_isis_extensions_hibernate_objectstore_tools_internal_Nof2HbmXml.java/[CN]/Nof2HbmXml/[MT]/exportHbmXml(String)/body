{
  final OutputFormat outformat=OutputFormat.createPrettyPrint();
  final File basedirFile=new File(basedir);
  for (final Iterator<PersistentSpecification> iter=persistentClasses.getPersistentClasses(); iter.hasNext(); ) {
    final PersistentSpecification persistentClass=iter.next();
    LOG.debug("exporting hbm.xml for " + persistentClass.getName());
    final Document doc=createDocument(persistentClass);
    final String className=persistentClass.getName();
    String dir="";
    String file;
    final int pos=className.lastIndexOf(".");
    if (pos < 0) {
      file=className;
    }
 else {
      file=className.substring(pos + 1);
      dir=className.substring(0,pos).replace(".",FILE_SEPERATOR);
    }
    file+=".hbm.xml";
    final File outputDir=new File(basedirFile,dir);
    outputDir.mkdirs();
    final File outFile=new File(outputDir,file);
    LOG.info("writing mapping file: " + outFile.getAbsolutePath());
    serializeToXML(doc,outFile,outformat);
  }
}
