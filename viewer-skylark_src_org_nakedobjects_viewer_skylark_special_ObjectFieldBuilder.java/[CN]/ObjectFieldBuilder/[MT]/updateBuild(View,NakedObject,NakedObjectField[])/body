{
  LOG.debug("  as update build");
  View[] subviews=view.getSubviews();
  outer:   for (int i=0; i < subviews.length; i++) {
    FieldContent fieldContent=((FieldContent)subviews[i].getContent());
    for (int j=0; j < flds.length; j++) {
      NakedObjectField field=flds[j];
      if (fieldContent.getField() == field) {
        continue outer;
      }
    }
    view.removeView(subviews[i]);
  }
  subviews=view.getSubviews();
  for (int i=0; i < subviews.length; i++) {
    View subview=subviews[i];
    NakedObjectField field=((FieldContent)subview.getContent()).getField();
    Naked value=object.getField(field);
    if (field.isValue()) {
      Naked naked=subview.getContent().getNaked();
      if (value != null && !value.getObject().equals(naked.getObject())) {
        View fieldView=createFieldView(view,object,field,value);
        view.replaceView(subview,decorateSubview(fieldView));
      }
      subview.refresh();
    }
 else     if (value instanceof NakedCollection) {
      subview.update(value);
    }
 else {
      NakedObject existing=((ObjectContent)subviews[i].getContent()).getObject();
      boolean changedValue=value != existing;
      if (changedValue) {
        View fieldView;
        try {
          fieldView=createFieldView(view,object,field,value);
        }
 catch (        NakedObjectFieldException e) {
          LOG.error("invalid field",e);
          fieldView=new FieldErrorView(e.getMessage());
        }
        if (fieldView != null) {
          view.replaceView(subview,decorateSubview(fieldView));
        }
      }
    }
  }
  outer2:   for (int j=0; j < flds.length; j++) {
    NakedObjectField field=flds[j];
    for (int i=0; i < subviews.length; i++) {
      FieldContent fieldContent=((FieldContent)subviews[i].getContent());
      if (fieldContent.getField() == field) {
        continue outer2;
      }
    }
    addField(view,object,field);
  }
{
    LOG.debug("fields:-");
    View[] dsubviews=view.getSubviews();
    for (int i=0; i < flds.length; i++) {
      LOG.debug("  - " + i + ") "+ flds[i].getId()+ " "+ flds[i].hashCode());
    }
    LOG.debug("subviews:-");
    for (int i=0; i < dsubviews.length; i++) {
      FieldContent fieldContent=((FieldContent)dsubviews[i].getContent());
      LOG.debug("  - " + i + ") "+ fieldContent.getFieldName()+ " "+ fieldContent.getField().hashCode());
    }
  }
}
