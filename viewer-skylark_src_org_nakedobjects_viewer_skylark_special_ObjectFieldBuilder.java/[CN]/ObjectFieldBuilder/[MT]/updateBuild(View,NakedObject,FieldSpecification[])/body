{
  LOG.debug("rebuild view " + view + " for "+ object);
  View[] subviews=view.getSubviews();
  int fld=0;
  for (int i=0; i < subviews.length; i++) {
    View subview=subviews[i];
    while (((FieldContent)subview.getContent()).getField() != flds[fld]) {
      fld++;
    }
    Assert.assertTrue(fld < flds.length);
    FieldSpecification field=flds[fld];
    try {
      Naked value=field.get(object);
      if (value instanceof NakedValue) {
        NakedValue existing=((ValueContent)subview.getContent()).getValue();
        if (value != existing) {
          ((ValueField)subview.getContent()).updateDerivedValue((NakedValue)value);
        }
        subview.refresh();
      }
 else       if (value instanceof NakedCollection) {
        subview.update((NakedObject)value);
      }
 else {
        NakedObject existing=((ObjectContent)subviews[i].getContent()).getObject();
        if (existing != value) {
          LOG.debug("field changed: " + field);
          View fieldView=subviewDesign.createSubview(createContent(object,value,field),view.getViewAxis());
          if (fieldView != null) {
            view.replaceView(subview,decorateSubview(fieldView));
          }
        }
      }
    }
 catch (    NakedObjectDefinitionException e) {
      LOG.error("Invalid field",e);
      view.addView(new FieldErrorView(e.getMessage()));
    }
    fld++;
  }
}
