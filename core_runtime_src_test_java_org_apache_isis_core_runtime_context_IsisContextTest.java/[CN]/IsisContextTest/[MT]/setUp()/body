{
  IsisContext.testReset();
  servicesList=Collections.emptyList();
  configuration=new IsisConfigurationDefault();
  oidMarshaller=new OidMarshaller();
  context.checking(new Expectations(){
{
      allowing(mockPersistenceSessionFactory).createPersistenceSession();
      will(returnValue(mockPersistenceSession));
      ignoring(mockPersistenceSession);
      ignoring(mockSpecificationLoader);
      ignoring(mockPersistenceSessionFactory);
      ignoring(mockUserProfileLoader);
      ignoring(mockAuthenticationManager);
      ignoring(mockAuthorizationManager);
      ignoring(mockTemplateImageLoader);
      ignoring(mockContainer);
    }
  }
);
  sessionFactory=new IsisSessionFactoryDefault(DeploymentType.EXPLORATION,configuration,mockSpecificationLoader,mockTemplateImageLoader,mockAuthenticationManager,mockAuthorizationManager,mockUserProfileLoader,mockPersistenceSessionFactory,mockContainer,servicesList,oidMarshaller);
  authSession=new SimpleSession("tester",Collections.<String>emptyList());
  IsisContext.setConfiguration(configuration);
}
