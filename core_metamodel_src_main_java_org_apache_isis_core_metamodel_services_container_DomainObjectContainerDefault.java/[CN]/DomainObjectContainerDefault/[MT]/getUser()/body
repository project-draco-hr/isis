{
  final AuthenticationSession session=getAuthenticationSessionProvider().getAuthenticationSession();
  final UserAndRoleOverrides userAndRoleOverrides=overrides.get().peek();
  final String username=userAndRoleOverrides != null ? userAndRoleOverrides.user : session.getUserName();
  final List<String> roles=userAndRoleOverrides != null ? userAndRoleOverrides.roles != null ? userAndRoleOverrides.roles : session.getRoles() : session.getRoles();
  final List<RoleMemento> roleMementos=asRoleMementos(roles);
  final UserMemento user=new UserMemento(username,roleMementos);
  return user;
}
