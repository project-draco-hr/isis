{
  response.setContentType("text/html");
  try {
    final Page page=controller.generatePage(context,req);
    if (context.isValid()) {
      if (controller.isDebug()) {
        controller.addDebug(page,req);
        addDebug(request,page);
      }
      PrintWriter writer;
      writer=response.getWriter();
      page.write(writer);
    }
 else {
      response.sendRedirect(getLogonPage());
    }
  }
  finally {
    if (!context.isLoggedIn()) {
      final HttpSession httpSession=request.getSession(false);
      LOG.info("dropping session: " + httpSession);
    }
  }
}
