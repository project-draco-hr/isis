{
  Oid oid=data.getOid();
  String type=data.getType();
  NakedObjectSpecification specification=NakedObjects.getSpecificationLoader().loadSpecification(type);
  NakedObjectLoader objectLoader=NakedObjects.getObjectLoader();
  NakedObject object;
  if (oid == null) {
    object=objectLoader.createTransientInstance(specification);
    recreateObjectsInFields(data,object);
  }
 else {
    object=objectLoader.recreateAdapterForPersistent(oid,specification);
    if (object.getResolveState().isResolvable(data.isResolved() ? ResolveState.RESOLVING : ResolveState.RESOLVING_PART)) {
      objectLoader.loading(object,data.isResolved() ? ResolveState.RESOLVING : ResolveState.RESOLVING_PART);
      recreateObjectsInFields(data,object);
      objectLoader.loaded(object,data.isResolved() ? ResolveState.RESOLVED : ResolveState.PART_RESOLVED);
    }
  }
  return object;
}
