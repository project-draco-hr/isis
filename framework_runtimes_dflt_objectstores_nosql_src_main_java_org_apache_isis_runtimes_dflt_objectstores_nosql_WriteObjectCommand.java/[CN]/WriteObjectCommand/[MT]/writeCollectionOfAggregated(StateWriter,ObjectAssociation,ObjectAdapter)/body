{
  final List<StateWriter> elementWriters=Lists.newArrayList();
  final CollectionFacet collectionFacet=collectionAdapter.getSpecification().getFacet(CollectionFacet.class);
  for (  final ObjectAdapter referencedAdapter : collectionFacet.iterable(collectionAdapter)) {
    final AggregatedOid elementOid=(AggregatedOid)referencedAdapter.getOid();
    final StateWriter elementWriter=writer.createElementWriter();
    elementWriter.writeId(elementOid.getLocalId());
    writeFields(elementWriter,referencedAdapter.getSpecification().getFullIdentifier(),referencedAdapter);
    elementWriters.add(elementWriter);
  }
  writer.writeCollection(association.getId(),elementWriters);
}
