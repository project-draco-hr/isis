{
  if (newChild == null)   throw new DomEx(DomEx.HIERARCHY_REQUEST_ERR);
  if (!(newChild instanceof NodeBase))   throw new DomEx(DomEx.WRONG_DOCUMENT_ERR);
  Document owner=newChild.getOwnerDocument();
  XmlDocument myOwner=ownerDocument;
  NodeBase child=(NodeBase)newChild;
  if (myOwner == null && this instanceof XmlDocument)   myOwner=(XmlDocument)this;
  if (owner != null && owner != myOwner)   throw new DomEx(DomEx.WRONG_DOCUMENT_ERR);
  if (owner == null) {
    child.setOwnerDocument(myOwner);
  }
  if (child.hasChildNodes()) {
    for (int i=0; true; i++) {
      Node node=child.item(i);
      if (node == null)       break;
      if (node.getOwnerDocument() == null)       ((NodeBase)node).setOwnerDocument(myOwner);
 else       if (node.getOwnerDocument() != myOwner)       throw new DomEx(DomEx.WRONG_DOCUMENT_ERR);
    }
  }
  return child;
}
