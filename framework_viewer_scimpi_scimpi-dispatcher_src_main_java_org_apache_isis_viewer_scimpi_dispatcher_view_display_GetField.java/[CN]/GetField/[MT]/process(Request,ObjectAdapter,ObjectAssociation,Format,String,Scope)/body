{
  final ObjectAdapter fieldReference=field.get(object);
  if (format != null && fieldReference.getResolveState().isValue()) {
    final DateValueFacet facet=fieldReference.getSpecification().getFacet(DateValueFacet.class);
    final Date date=facet.dateValue(fieldReference);
    final String value=format.format(date);
    request.appendDebug("    " + object + " -> "+ value);
    request.getContext().addVariable(name,Request.getEncoder().encoder(value),scope);
  }
 else {
    final String source=fieldReference == null ? "" : request.getContext().mapObject(fieldReference,scope);
    request.appendDebug("    " + object + " -> "+ source);
    request.getContext().addVariable(name,source,scope);
  }
}
