{
  File f=new File("xat.properties");
  Configuration configuration;
  if (f.exists()) {
    configuration=new Configuration(new ConfigurationPropertiesLoader(f.getAbsolutePath(),true));
  }
 else {
    configuration=new Configuration();
  }
  NakedObjectsClient nakedObjects=new NakedObjectsClient();
  nakedObjects.setConfiguration(configuration);
  fixtureBuilder=createFixtureBuilder();
  if (testObjectFactory == null) {
    testObjectFactory=(TestObjectFactory)ComponentLoader.loadComponent(TEST_OBJECT_FACTORY,NonDocumentingTestObjectFactory.class,TestObjectFactory.class);
  }
  documentor=testObjectFactory.getDocumentor();
  documentor.start();
  String className=getClass().getName();
  String methodName=getName().substring(4);
  testObjectFactory.testStarting(className,methodName);
  setupFramework(nakedObjects);
  nakedObjects.setSession(new NullSession());
  nakedObjects.init();
  setUpFixtures();
  try {
    fixtureBuilder.installFixtures();
    String[] cls=fixtureBuilder.getClasses();
    for (int i=0; i < cls.length; i++) {
      NakedObjectSpecification spec=NakedObjects.getSpecificationLoader().loadSpecification(cls[i]);
      NakedClass nakedClass=new NakedClass(cls[i]);
      TestClass view=testObjectFactory.createTestClass(nakedClass);
      classes.put(spec.getFullName().toLowerCase(),view);
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw e;
  }
  NakedObjects.getObjectManager().reset();
}
