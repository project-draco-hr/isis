{
  File f=new File("xat.properties");
  PropertiesConfiguration configuration;
  if (f.exists()) {
    configuration=new PropertiesConfiguration(new PropertiesFileLoader(f.getAbsolutePath(),true));
  }
 else {
    configuration=new PropertiesConfiguration();
  }
  nakedObjects=new NakedObjectsClient();
  nakedObjects.setConfiguration(configuration);
  fixtureBuilder=createFixtureBuilder();
  if (testObjectFactory == null) {
    String factoryName=configuration.getString(TEST_OBJECT_FACTORY);
    if (factoryName != null) {
      testObjectFactory=(TestObjectFactory)ComponentLoader.loadComponent(factoryName,TestObjectFactory.class);
    }
 else {
      testObjectFactory=new NonDocumentingTestObjectFactory();
    }
  }
  documentor=testObjectFactory.getDocumentor();
  documentor.start();
  String className=getClass().getName();
  String methodName=getName().substring(4);
  testObjectFactory.testStarting(className,methodName);
  setupFramework(nakedObjects);
  nakedObjects.setSession(new NullSession());
  nakedObjects.init();
  setUpFixtures();
  try {
    fixtureBuilder.installFixtures();
    String[] cls=fixtureBuilder.getClasses();
    for (int i=0; i < cls.length; i++) {
      NakedObjectSpecification spec=NakedObjects.getSpecificationLoader().loadSpecification(cls[i]);
      NakedClass nakedClass=new NakedClassImpl(cls[i]);
      TestClass view=testObjectFactory.createTestClass(nakedClass);
      classes.put(spec.getFullName().toLowerCase(),view);
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw e;
  }
  NakedObjects.getObjectPersistor().reset();
}
