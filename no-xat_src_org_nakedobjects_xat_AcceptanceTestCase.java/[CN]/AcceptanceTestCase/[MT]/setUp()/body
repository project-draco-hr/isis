{
  File f=new File("xat.properties");
  Configuration configuration;
  if (f.exists()) {
    configuration=new Configuration(new ConfigurationPropertiesLoader(f.getAbsolutePath(),true));
  }
 else {
    configuration=new Configuration();
  }
  NakedObjects.setConfiguration(configuration);
  ConfigurationFactory.setConfiguration(configuration);
  Properties logProperties=NakedObjects.getConfiguration().getProperties("log4j");
  if (logProperties.size() == 0) {
    LogManager.getRootLogger().setLevel(Level.OFF);
  }
 else {
    PropertyConfigurator.configure(logProperties);
  }
  Logger.getLogger(AcceptanceTestCase.class).debug("XAT Logging enabled - new test: " + getName());
  fixtureBuilder=createFixtureBuilder();
  if (testObjectFactory == null) {
    testObjectFactory=(TestObjectFactory)ComponentLoader.loadComponent(TEST_OBJECT_FACTORY,NonDocumentingTestObjectFactory.class,TestObjectFactory.class);
  }
  documentor=testObjectFactory.getDocumentor();
  documentor.start();
  String className=getClass().getName();
  String methodName=getName().substring(4);
  testObjectFactory.testStarting(className,methodName);
  PojoAdapterFactoryImpl pojoAdapterFactory=new PojoAdapterFactoryImpl();
  pojoAdapterFactory.setPojoAdapterHash(new PojoAdapterHashImpl());
  NakedObjects.setPojoAdapterFactory(pojoAdapterFactory);
  setupFramework();
  NakedObjects.setSessionLookup(new ClientSessionLookup(new Session()));
  setUpFixtures();
  try {
    fixtureBuilder.installFixtures();
    String[] cls=fixtureBuilder.getClasses();
    for (int i=0; i < cls.length; i++) {
      NakedObjectSpecification nc=NakedObjects.getSpecificationLoader().loadSpecification(cls[i]);
      NakedClass spec=new NakedClass(cls[i]);
      TestClass view=testObjectFactory.createTestClass(spec);
      classes.put(nc.getFullName().toLowerCase(),view);
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw e;
  }
}
