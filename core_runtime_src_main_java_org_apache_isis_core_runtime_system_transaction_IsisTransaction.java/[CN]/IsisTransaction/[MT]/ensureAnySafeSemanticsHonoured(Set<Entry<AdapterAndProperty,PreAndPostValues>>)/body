{
  final CommandContext commandContext=getServiceOrNull(CommandContext.class);
  if (commandContext == null) {
    return;
  }
  final Command command=commandContext.getCommand();
  if (!(command instanceof Command2)) {
    return;
  }
  final Command2 command2=(Command2)command;
  final ActionInteractionEvent<?> event=command2.getActionInteractionEvent();
  if (event == null) {
    return;
  }
  final ActionSemantics.Of actionSemantics=event.getActionSemantics();
  if (actionSemantics == null) {
    return;
  }
  if (!actionSemantics.isSafe()) {
    return;
  }
  final Set<ObjectAdapter> changedAdapters=findChangedAdapters(changedObjectProperties);
  if (!changedAdapters.isEmpty()) {
    final String msg="Action '" + event.getIdentifier().toFullIdentityString() + "'"+ " (with safe semantics)"+ " caused "+ changedAdapters.size()+ " object"+ (changedAdapters.size() != 1 ? "s" : "")+ " to be modified";
    LOG.error(msg);
    for (    ObjectAdapter changedAdapter : changedAdapters) {
      final StringBuilder builder=new StringBuilder("  > ").append(changedAdapter.getSpecification().getFullIdentifier()).append(": ");
      if (!changedAdapter.isDestroyed()) {
        builder.append(changedAdapter.titleString(null));
      }
 else {
        builder.append("(deleted object)");
      }
      LOG.error(builder.toString());
    }
    final boolean enforceSafeSemantics=IsisContext.getConfiguration().getBoolean(PersistenceConstants.ENFORCE_SAFE_SEMANTICS,PersistenceConstants.ENFORCE_SAFE_SEMANTICS_DEFAULT);
    if (enforceSafeSemantics) {
      throw new RecoverableException(msg);
    }
  }
}
