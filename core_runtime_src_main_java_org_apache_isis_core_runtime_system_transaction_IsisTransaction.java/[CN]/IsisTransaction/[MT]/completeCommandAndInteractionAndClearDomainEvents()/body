{
  final Command command=commandContext.getCommand();
  final Interaction interaction=interactionContext.getInteraction();
  if (command.getStartedAt() != null && command.getCompletedAt() == null) {
    Interaction.Execution priorExecution=interaction.getPriorExecution();
    final Timestamp completedAt=priorExecution.getCompletedAt();
    command.setCompletedAt(completedAt);
  }
  commandService.complete(command);
  if (command instanceof Command3) {
    final Command3 command3=(Command3)command;
    command3.flushActionDomainEvents();
  }
 else   if (command instanceof Command2) {
    final Command2 command2=(Command2)command;
    command2.flushActionInteractionEvents();
  }
  interaction.clear();
}
