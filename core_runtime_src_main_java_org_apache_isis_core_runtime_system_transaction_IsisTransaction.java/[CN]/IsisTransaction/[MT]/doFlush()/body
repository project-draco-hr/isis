{
  int i=0;
  do {
    final List<PersistenceCommand> persistenceCommandList=Lists.newArrayList(persistenceCommands);
    if (!persistenceCommandList.isEmpty()) {
      persistenceCommands.removeAll(persistenceCommandList);
      try {
        objectStore.execute(persistenceCommandList);
        for (        PersistenceCommand persistenceCommand : persistenceCommandList) {
          if (persistenceCommand instanceof DestroyObjectCommand) {
            final ObjectAdapter adapter=persistenceCommand.onAdapter();
            adapter.setVersion(null);
            if (!adapter.isDestroyed()) {
              adapter.changeState(ResolveState.DESTROYED);
            }
          }
        }
      }
 catch (      final RuntimeException ex) {
        persistenceCommands.clear();
        throw ex;
      }
    }
  }
 while (!persistenceCommands.isEmpty());
}
