{
  int i=0;
  do {
    PersistenceCommand command=commands.isEmpty() ? null : commands.get(0);
    if (command != null) {
      commands.remove(command);
      try {
        objectStore.execute(Collections.singletonList(command));
        if (command instanceof DestroyObjectCommand) {
          final ObjectAdapter adapter=command.onAdapter();
          adapter.setVersion(null);
          if (!adapter.isDestroyed()) {
            adapter.changeState(ResolveState.DESTROYED);
          }
        }
      }
 catch (      final RuntimeException ex) {
        commands.clear();
        throw ex;
      }
    }
  }
 while (!commands.isEmpty());
}
