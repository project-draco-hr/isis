{
  ensureThatState(getState().canCommit(),is(true),"state is: " + getState());
  ensureThatState(exceptions.isEmpty(),is(true),"cannot commit: " + exceptions.size() + " exceptions have been raised");
  if (LOG.isDebugEnabled()) {
    LOG.debug("commit transaction " + this);
  }
  if (getState() == State.COMMITTED) {
    if (LOG.isInfoEnabled()) {
      LOG.info("already committed; ignoring");
    }
    return;
  }
  try {
    doAudit(getChangedObjectProperties());
    doFlush();
    setState(State.COMMITTED);
    doPublish(getChangedObjects());
  }
 catch (  final RuntimeException ex) {
    setAbortCause(ex);
    throw ex;
  }
}
