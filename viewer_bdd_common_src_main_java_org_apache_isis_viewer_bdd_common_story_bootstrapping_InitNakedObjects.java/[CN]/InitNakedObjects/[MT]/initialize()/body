{
  configurationBuilder.add(SystemConstants.AUTHENTICATION_INSTALLER_KEY,StoryAuthenticationManagerInstaller.class.getName());
  configurationBuilder.add(SystemConstants.OBJECT_PERSISTOR_INSTALLER_KEY,StoryInMemoryPersistenceMechanismInstaller.class.getName());
  configurationBuilder.add(SystemConstants.PROFILE_PERSISTOR_INSTALLER_KEY,InMemoryUserProfileStoreInstaller.class.getName());
  configurationBuilder.add(SystemConstants.FIXTURES_INSTALLER_KEY,FixturesInstallerNoop.class.getName());
  configurationBuilder.add(SystemConstants.NOSPLASH_KEY,"" + true);
  IsisSystem system=null;
  try {
    final InstallerLookupDefault installerLookup=new InstallerLookupDefault(getClass());
    configurationBuilder.injectInto(installerLookup);
    configurationBuilder.add(SystemConstants.DEPLOYMENT_TYPE_KEY,deploymentType.name());
    Injector injector=createGuiceInjector(deploymentType,configurationBuilder,installerLookup);
    system=injector.getInstance(IsisSystem.class);
    getStory().setInstallerLookup(installerLookup);
    getStory().setNakedObjectsSystem(system);
    IsisContext.openSession(new InitialisationSession());
  }
 catch (  final RuntimeException e) {
    if (system != null) {
      system.shutdown();
    }
    throw e;
  }
}
