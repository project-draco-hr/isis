{
  ensureOpened();
  ensureThatState(entityManager,is(notNullValue()));
  final IsisTransaction currentTransaction=getTransactionManager().getTransaction();
  if (currentTransaction != null && currentTransaction.getState().canCommit()) {
    getTransactionManager().endTransaction();
  }
  entityManager.close();
  state=State.CLOSED;
}
