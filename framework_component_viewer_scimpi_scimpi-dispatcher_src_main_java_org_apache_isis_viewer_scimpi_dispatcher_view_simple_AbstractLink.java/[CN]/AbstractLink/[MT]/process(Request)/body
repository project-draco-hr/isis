{
  final String title=request.getOptionalProperty(FORM_TITLE);
  final String name=request.getOptionalProperty(NAME);
  final boolean showAsButton=request.isRequested("show-as-button",false);
  final String linkClass=request.getOptionalProperty(CLASS,showAsButton ? "button" : defaultLinkClass());
  final String containerClass=request.getOptionalProperty(CONTAINER_CLASS,"action");
  final String object=request.getOptionalProperty(OBJECT);
  final RequestContext context=request.getContext();
  String objectId=object != null ? object : (String)context.getVariable(RequestContext.RESULT);
  ObjectAdapter adapter=MethodsUtils.findObject(context,objectId);
  final String fieldName=request.getOptionalProperty(FIELD);
  if (fieldName != null) {
    final ObjectAssociation field=adapter.getSpecification().getAssociation(fieldName);
    if (field == null) {
      throw new ScimpiException("No field " + fieldName + " in "+ adapter.getSpecification().getFullIdentifier());
    }
    final Where where=Where.ANYWHERE;
    if (field.isVisible(IsisContext.getAuthenticationSession(),adapter,where).isVetoed()) {
      throw new ForbiddenException(field,ForbiddenException.VISIBLE);
    }
    IsisContext.getPersistenceSession().resolveField(adapter,field);
    adapter=field.get(adapter);
    if (adapter != null) {
      objectId=context.mapObject(adapter,Scope.INTERACTION);
    }
  }
  if (adapter != null && valid(request,adapter)) {
    final String variable=request.getOptionalProperty("param-name",RequestContext.RESULT);
    final String variableSegment=variable + "=" + objectId;
    String view=request.getOptionalProperty(VIEW);
    if (view == null) {
      view=defaultView();
    }
    view=context.fullUriPath(view);
    final String classSegment=" class=\"" + linkClass + "\"";
    final String titleSegment=title == null ? "" : (" title=\"" + title + "\"");
    String additionalSegment=additionalParameters(request);
    additionalSegment=additionalSegment == null ? "" : "&amp;" + additionalSegment;
    if (showAsButton) {
      request.appendHtml("<div class=\"" + containerClass + "\">");
    }
    request.appendHtml("<a" + classSegment + titleSegment+ " href=\""+ view+ "?"+ variableSegment+ context.encodedInteractionParameters()+ additionalSegment+ "\">");
    request.pushNewBuffer();
    request.processUtilCloseTag();
    final String buffer=request.popBuffer();
    if (buffer.trim().length() > 0) {
      request.appendHtml(buffer);
    }
 else {
      request.appendAsHtmlEncoded(linkLabel(name,adapter));
    }
    request.appendHtml("</a>");
    if (showAsButton) {
      request.appendHtml("</div>");
    }
  }
 else {
    request.skipUntilClose();
  }
}
