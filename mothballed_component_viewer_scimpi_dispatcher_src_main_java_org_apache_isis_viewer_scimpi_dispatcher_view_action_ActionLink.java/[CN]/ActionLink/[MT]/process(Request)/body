{
  String objectId=request.getOptionalProperty(OBJECT);
  final String method=request.getOptionalProperty(METHOD);
  final String forwardResultTo=request.getOptionalProperty(VIEW);
  final String forwardVoidTo=request.getOptionalProperty(VOID);
  String resultOverride=request.getOptionalProperty(RESULT_OVERRIDE);
  final String resultName=request.getOptionalProperty(RESULT_NAME);
  final String resultNameSegment=resultName == null ? "" : "&amp;" + RESULT_NAME + "="+ resultName;
  final String scope=request.getOptionalProperty(SCOPE);
  final String scopeSegment=scope == null ? "" : "&amp;" + SCOPE + "="+ scope;
  final String confirm=request.getOptionalProperty(CONFIRM);
  final String completionMessage=request.getOptionalProperty(MESSAGE);
  final String idName=request.getOptionalProperty(ID,method);
  final String className=request.getOptionalProperty(CLASS);
  final String confirmSegment=confirm == null ? "" : "&amp;" + "_" + CONFIRM + "="+ URLEncoder.encode(confirm);
  final String messageSegment=completionMessage == null ? "" : "&amp;" + "_" + MESSAGE + "="+ URLEncoder.encode(completionMessage);
  final RequestContext context=request.getContext();
  final ObjectAdapter object=MethodsUtils.findObject(context,objectId);
  final String version=context.mapVersion(object);
  final ObjectAction action=MethodsUtils.findAction(object,method);
  final ActionContent parameterBlock=new ActionContent(action);
  request.setBlockContent(parameterBlock);
  request.pushNewBuffer();
  request.processUtilCloseTag();
  final String text=request.popBuffer();
  final String[] parameters=parameterBlock.getParameters();
  final String target;
  final ObjectAdapter[] objectParameters;
  if (false) {
  }
 else {
    objectParameters=new ObjectAdapter[parameters.length];
    target=StringEscapeUtils.escapeHtml(request.getContext().mapObject(object,Scope.INTERACTION));
    int i=0;
    for (    final ObjectActionParameter spec : action.getParameters()) {
      final ObjectSpecification type=spec.getSpecification();
      if (parameters[i] == null) {
        objectParameters[i]=null;
      }
 else       if (type.getFacet(ParseableFacet.class) != null) {
        final ParseableFacet facet=type.getFacet(ParseableFacet.class);
        Localization localization=IsisContext.getLocalization();
        objectParameters[i]=facet.parseTextEntry(null,parameters[i],localization);
      }
 else {
        objectParameters[i]=MethodsUtils.findObject(request.getContext(),parameters[i]);
      }
      i++;
    }
  }
  if (MethodsUtils.isVisibleAndUsable(object,action,where) && MethodsUtils.canRunMethod(object,action,objectParameters).isAllowed()) {
    writeLink(request,idName,className,target,version,method,forwardResultTo,forwardVoidTo,resultNameSegment,resultOverride,scopeSegment,confirmSegment,messageSegment,context,action,parameters,text);
  }
  request.popBlockContent();
}
