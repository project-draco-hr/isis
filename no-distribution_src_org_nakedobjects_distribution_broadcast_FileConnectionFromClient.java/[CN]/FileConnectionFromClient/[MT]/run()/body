{
  InputStream in=null;
  OutputStream out=null;
  try {
    in=clientSocket.getInputStream();
    byte[] b=new byte[100];
    int len=in.read(b);
    if (len >= 0) {
      String path=new String(b,0,len);
      LOG.info("File requested " + path);
      File f=new File(Configuration.getInstance().getString(DIRECTORY,"./"),path);
      LOG.debug("Looking for " + f.getAbsolutePath() + f.exists());
      byte[] data=null;
      if (f.exists() && f.isFile()) {
        data=new byte[(int)f.length()];
        FileInputStream fis=new FileInputStream(f);
        fis.read(data);
        LOG.info("Returning " + data.length + " bytes");
        out=clientSocket.getOutputStream();
        out.write(data);
      }
 else {
        LOG.info("Returning null - file not found");
      }
    }
 else {
      LOG.info("Client disconnected");
    }
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
 finally {
    if (in != null) {
      try {
        in.close();
      }
 catch (      IOException ignore) {
        LOG.error("Error while closing socket input stream",ignore);
      }
    }
    if (out != null) {
      try {
        out.close();
      }
 catch (      IOException ignore) {
        LOG.error("Error while closing socket output stream",ignore);
      }
    }
  }
}
