{
  context.allowing(mockSpecificationLoader);
  facetFactory=new TitleAnnotationFacetFactory();
  facetFactory.setServicesInjector(mockServicesInjector);
  context.checking(new Expectations(){
{
      allowing(mockServicesInjector).lookupService(AuthenticationSessionProvider.class);
      will(returnValue(mockAuthenticationSessionProvider));
      allowing(mockServicesInjector).lookupService(DeploymentCategoryProvider.class);
      will(returnValue(mockDeploymentCategoryProvider));
      allowing(mockLocalizationProviderInternal).getLocalization();
      will(returnValue(new LocalizationDefault()));
      allowing(mockDeploymentCategoryProvider).getDeploymentCategory();
      will(returnValue(DeploymentCategory.PRODUCTION));
      allowing(mockAuthenticationSessionProvider).getAuthenticationSession();
      will(returnValue(mockAuthenticationSession));
      allowing(mockServicesInjector).lookupService(SpecificationLoader.class);
      will(returnValue(mockSpecificationLoader));
      allowing(mockServicesInjector).lookupService(PersistenceSessionServiceInternal.class);
      will(returnValue(mockAdapterManager));
    }
  }
);
  facetFactory.setServicesInjector(mockServicesInjector);
}
