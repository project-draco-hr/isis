{
  String objectId=request.getOptionalProperty(OBJECT);
  String methodName=request.getRequiredProperty(METHOD);
  String forwardResultTo=request.getOptionalProperty(VIEW);
  String forwardVoidTo=request.getOptionalProperty(VOID);
  String forwardErrorTo=request.getOptionalProperty(ERRORS);
  String variable=request.getOptionalProperty(RESULT_NAME);
  String scope=request.getOptionalProperty(SCOPE);
  String buttonTitle=request.getOptionalProperty(BUTTON_TITLE);
  String resultOverride=request.getOptionalProperty(RESULT_OVERRIDE);
  String idName=request.getOptionalProperty(ID,methodName);
  String className=request.getOptionalProperty(CLASS);
  boolean showMessage=request.isRequested(SHOW_MESSAGE,false);
  String completionMessage=request.getOptionalProperty(MESSAGE);
  ObjectAdapter object=MethodsUtils.findObject(request.getContext(),objectId);
  String version=request.getContext().mapVersion(object);
  ObjectAction action=MethodsUtils.findAction(object,methodName);
  ActionContent parameterBlock=new ActionContent(action);
  request.setBlockContent(parameterBlock);
  request.processUtilCloseTag();
  String[] parameters=parameterBlock.getParameters();
  ObjectAdapter[] objectParameters=new ObjectAdapter[parameters.length];
  int i=0;
  for (  ObjectActionParameter spec : action.getParameters()) {
    ObjectSpecification typ=spec.getSpecification();
    if (parameters[i] == null) {
      objectParameters[i]=null;
    }
 else     if (typ.getFacet(ParseableFacet.class) != null) {
      ParseableFacet facet=(ParseableFacet)typ.getFacet(ParseableFacet.class);
      objectParameters[i]=facet.parseTextEntry(null,parameters[i]);
    }
 else {
      objectParameters[i]=MethodsUtils.findObject(request.getContext(),parameters[i]);
    }
    i++;
  }
  if (MethodsUtils.isVisibleAndUsable(object,action) && MethodsUtils.canRunMethod(object,action,objectParameters).isAllowed()) {
    write(request,object,action,parameters,objectId,version,forwardResultTo,forwardVoidTo,forwardErrorTo,variable,scope,buttonTitle,completionMessage,resultOverride,idName,className);
  }
  if (showMessage) {
    Consent usable=action.isUsable(IsisContext.getAuthenticationSession(),object);
    if (usable.isVetoed()) {
      String notUsable=MethodsUtils.isUsable(object,action);
      if (notUsable != null) {
        request.appendHtml("<div class=\"" + className + "-message\" >"+ notUsable+ "</div>");
      }
    }
  }
  request.popBlockContent();
}
