{
  final String requestData=xstream.toXML(request);
  if (LOG.isInfoEnabled()) {
    LOG.info("sending " + requestData.length() + " bytes of data");
  }
  try {
    if (LOG.isDebugEnabled()) {
      LOG.debug("sending request \n" + requestData);
    }
    try {
      output.writeObject(requestData);
    }
 catch (    final SocketException e) {
      reconnect();
      output.writeObject(requestData);
    }
    output.flush();
    final String responseData=(String)input.readObject();
    if (LOG.isDebugEnabled()) {
      LOG.debug("response received: \n" + responseData);
    }
    return xstream.fromXML(responseData);
  }
 catch (  final StreamCorruptedException e) {
    try {
      final int available=input.available();
      if (LOG.isDebugEnabled()) {
        LOG.debug("error in reading; skipping bytes: " + available);
      }
      input.skip(available);
    }
 catch (    final IOException e1) {
      e1.printStackTrace();
    }
    throw new ConnectionException(e.getMessage(),e);
  }
catch (  final ClassNotFoundException e) {
    throw new ConnectionException("Failed request",e);
  }
}
