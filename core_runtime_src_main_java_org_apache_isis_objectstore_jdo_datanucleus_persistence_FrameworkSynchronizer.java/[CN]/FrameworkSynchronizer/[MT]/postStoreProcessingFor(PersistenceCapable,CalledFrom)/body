{
  withLogging(pojo,new Runnable(){
    @Override public void run(){
      ensureRootObject(pojo);
      if (!pojo.jdoIsPersistent()) {
        throw new IllegalStateException("Pojo JDO state is not persistent! pojo dnOid: " + JDOHelper.getObjectId(pojo));
      }
      final ObjectAdapter adapter=getAdapterManager().getAdapterFor(pojo);
      final RootOid isisOid=(RootOid)adapter.getOid();
      if (isisOid.isTransient()) {
        final RootOid persistentOid=getOidGenerator().createPersistentOrViewModelOid(pojo,isisOid);
        getPersistenceSession().remapAsPersistent(adapter,persistentOid);
        CallbackFacet.Util.callCallback(adapter,PersistedCallbackFacet.class);
        final IsisTransaction transaction=getCurrentTransaction();
        transaction.enlistCreated(adapter);
      }
 else {
        CallbackFacet.Util.callCallback(adapter,UpdatedCallbackFacet.class);
      }
      Utils.clearDirtyFor(adapter);
      Version versionIfAny=getVersionIfAny(pojo);
      adapter.setVersion(versionIfAny);
      ensureFrameworksInAgreement(pojo);
    }
  }
,calledFrom);
}
