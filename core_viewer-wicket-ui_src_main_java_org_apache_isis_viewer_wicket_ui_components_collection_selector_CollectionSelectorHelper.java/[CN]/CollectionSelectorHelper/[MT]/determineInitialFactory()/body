{
  final String sessionAttribute=selectedItemSessionAttribute.get();
  if (sessionAttribute != null) {
    return sessionAttribute;
  }
  final CollectionLayoutData layoutData=this.model.getLayoutData();
  if (layoutData != null) {
    final String defaultView=layoutData.getDefaultView();
    if (defaultView != null) {
      return defaultView;
    }
  }
  if (hasDefaultViewFacet(model)) {
    DefaultViewFacet defaultViewFacet=model.getCollectionMemento().getCollection().getFacet(DefaultViewFacet.class);
    for (    ComponentFactory componentFactory : componentFactories) {
      final String componentName=componentFactory.getName();
      final String viewName=defaultViewFacet.value();
      if (componentName.equalsIgnoreCase(viewName)) {
        return componentName;
      }
    }
  }
  return hasRenderEagerlyFacet(model) ? CollectionContentsAsAjaxTablePanelFactory.NAME : CollectionContentsHiddenPanelFactory.NAME;
}
