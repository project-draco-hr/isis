{
  LOG.debug("Compiling object data for " + object);
  ObjectData data;
  data=new ObjectData(object.getSpecification(),(SimpleOid)object.getOid());
  FieldSpecification[] fields=object.getSpecification().getFields();
  for (int i=0; i < fields.length; i++) {
    if (fields[i].isDerived()) {
      continue;
    }
    Naked fieldContent=(Naked)fields[i].get(object);
    String fieldName=fields[i].getName();
    if (fieldContent instanceof InternalCollection) {
      data.addInternalCollection((InternalCollection)fieldContent,fieldName,ensurePersistent);
    }
 else     if (fieldContent instanceof NakedValue) {
      data.addValue((NakedValue)fieldContent,fieldName);
    }
 else {
      data.addAssociation((NakedObject)fieldContent,fieldName,ensurePersistent);
    }
  }
  return data;
}
