{
  context.checking(new Expectations(){
{
      one(commandContext).createStateWriter(epc1Adapter.getSpecification().getFullIdentifier());
      will(returnValue(writer));
      one(keyCreator).key(RootOidDefault.create("EPC|1"));
      will(returnValue("6"));
      one(writer).writeId("6");
      one(writer).writeType(epc1Adapter.getSpecification().getFullIdentifier());
      one(keyCreator).reference(epv1Adapter);
      will(returnValue("ref@3"));
      one(keyCreator).reference(epv2Adapter);
      will(returnValue("ref@4"));
      one(writer).writeField("homogenousCollection","ref@3|ref@4|");
      one(writer).writeVersion(null,"2");
      one(writer).writeUser("username");
      one(writer).writeTime("1057");
      one(writer).writeEncryptionType("etc1");
      one(commandContext).insert(writer);
    }
  }
);
  new WriteObjectCommand(false,keyCreator,versionCreator,dataEncrypter,epc1Adapter).execute(commandContext);
  context.assertIsSatisfied();
}
