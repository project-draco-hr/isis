{
  ServletOutputStream out=response.getOutputStream();
  DataInputStream fileInputStream=null;
  try {
    response.setStatus(HttpServletResponse.SC_OK);
    response.setContentType("text/html");
    String cls=request.getParameter("class");
    String returnId=request.getParameter("return");
    out.println("<p>New " + cls);
    HttpSession session=request.getSession(false);
    if (session == null) {
      response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR,"Out of session");
    }
    NakedObjectManager objectManager=NakedObjects.getObjectManager();
    NakedObject object=objectManager.createInstance(cls);
    form(out,object);
    out.println("<hr>");
    if (returnId != null) {
      NakedObject returnObject=objectManager.getObject(new SerialOid(Long.valueOf(returnId).longValue()),null);
      String param="id=" + returnId;
      out.println("<p>Return to <a href=\"object?" + param + "\">"+ image(returnObject,16)+ returnObject.titleString().toString()+ "</a> ");
    }
    out.flush();
  }
 catch (  ObjectStoreException e) {
    out.println("<p>Exception in object store " + e);
  }
catch (  IOException e) {
    System.err.println("IO Error " + e);
    e.printStackTrace();
    return;
  }
 finally {
    if (fileInputStream != null) {
      try {
        fileInputStream.close();
      }
 catch (      IOException ignoree) {
      }
    }
  }
}
