{
  LOG.debug("getInstances of " + specification);
  if (includeSubclasses) {
    NakedObject[] instances=getInstances(specification);
    NakedObjectSpecification[] subclasses=specification.subclasses();
    for (int i=0; i < subclasses.length; i++) {
      NakedObject[] subclassInstances=getInstances(subclasses[i],true);
      if (subclassInstances != null) {
        NakedObject[] in=new NakedObject[instances.length + subclassInstances.length];
        System.arraycopy(instances,0,in,0,instances.length);
        System.arraycopy(subclassInstances,0,in,0,subclassInstances.length);
        instances=in;
      }
    }
    return instances;
  }
 else {
    return getInstances(specification);
  }
}
