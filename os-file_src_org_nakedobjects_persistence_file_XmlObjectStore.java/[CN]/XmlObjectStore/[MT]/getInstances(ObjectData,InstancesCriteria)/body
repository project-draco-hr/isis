{
  ObjectDataVector data=dataManager.getInstances(patternData);
  NakedObject[] instances=new NakedObject[data.size()];
  int count=0;
  for (int i=0; i < data.size(); i++) {
    ObjectData instanceData=data.element(i);
    LOG.debug("instance data " + instanceData);
    SerialOid oid=instanceData.getOid();
    NakedObjectSpecification spec=specFor(instanceData);
    NakedObject instance=objectLoader.recreateAdapter(oid,spec);
    initObject(instance,instanceData);
    if (criteria == null || criteria.matches(instance)) {
      instances[count++]=instance;
    }
  }
  NakedObject[] array=new NakedObject[count];
  System.arraycopy(instances,0,array,0,count);
  return array;
}
