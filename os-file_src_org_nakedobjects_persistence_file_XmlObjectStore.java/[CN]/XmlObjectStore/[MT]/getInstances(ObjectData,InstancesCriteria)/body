{
  ObjectDataVector data=dataManager.getInstances(patternData);
  NakedObject[] instances=new NakedObject[data.size()];
  int count=0;
  for (int i=0; i < data.size(); i++) {
    ObjectData instanceData=data.element(i);
    LOG.debug("instance data " + instanceData);
    SerialOid oid=instanceData.getOid();
    NakedObject instance;
    if (loadedObjects().isLoaded(oid)) {
      instance=loadedObjects().getLoadedObject(oid);
    }
 else {
      instance=(NakedObject)createSkeletalObject(oid,instanceData.getClassName());
      loadedObjects().loaded(instance);
    }
    resolveImmediately(instance);
    initObject(instance,instanceData);
    if (criteria == null || criteria.matches(instance)) {
      instances[count++]=instance;
    }
  }
  NakedObject[] array=new NakedObject[count];
  System.arraycopy(instances,0,array,0,count);
  return array;
}
