{
  ObjectMapper mapper=(ObjectMapper)mappers.get(cls);
  if (mapper == null) {
    AutoMapper autoMapper=(AutoMapper)mapperFactory.createMapper(cls.fullName(),SqlObjectStore.BASE_NAME + ".automapper.default");
    DatabaseConnector connection=connectionPool.acquire();
    autoMapper.startup(connection,this,loadedObjects);
    if (autoMapper.needsTables(connection)) {
      autoMapper.createTables(connection);
    }
    mapper=autoMapper;
    connectionPool.release(connection);
  }
  LOG.debug("  mapper for " + cls.getSingularName() + " -> "+ mapper);
  if (mapper == null) {
    throw new NakedObjectRuntimeException("No mapper for " + cls + " (no default mapper)");
  }
  return mapper;
}
