{
  String[] snapshots=directory.list(new FilenameFilter(){
    public boolean accept(    File dir,    String name){
      return name.startsWith(snapshotFilename) && name.endsWith(suffix);
    }
  }
);
  String max=snapshotFilename + PADDING + suffix;
  for (int i=0; i < snapshots.length; i++) {
    if (max.compareTo(snapshots[i]) < 0) {
      max=snapshots[i];
    }
  }
  String number=max.substring(snapshotFilename.length(),max.length() - suffix.length());
  version=Integer.valueOf(number).intValue() + 1;
  String filepath=snapshotFilename + number + suffix;
  return filepath;
}
