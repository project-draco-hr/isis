{
  NakedObject source=drag.getSourceObject();
  if (canAdd(source).isAllowed()) {
    InternalCollection target=((InternalCollection)getObject());
    if (source instanceof NakedClass && target.getType() != NakedClass.class) {
      source=(NakedObject)((NakedClass)source).acquireInstance();
      try {
        NakedObjectManager.getInstance().makePersistent(source);
      }
 catch (      NotPersistableException e) {
        source=new NakedError("Failed to create object",e);
        RootView view=ViewFactory.getViewFactory().createRootView(source);
        view.setLocation(drag.getRelativeLocation());
        getWorkspace().addRootView(view);
        return;
      }
      source.created();
    }
    if (canAdd(source).isAllowed()) {
      Field fieldOf=getFieldOf();
      ((OneToManyAssociation)fieldOf).setAssociation(((ObjectView)getParent()).getObject(),source);
      invalidateLayout();
      validateLayout();
    }
  }
}
