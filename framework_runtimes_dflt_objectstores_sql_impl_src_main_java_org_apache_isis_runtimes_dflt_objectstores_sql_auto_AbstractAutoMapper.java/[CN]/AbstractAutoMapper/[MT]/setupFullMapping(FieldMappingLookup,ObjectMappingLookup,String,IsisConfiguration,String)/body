{
  final List<? extends ObjectAssociation> fields=specification.getAssociations();
  int simpleFieldCount=0;
  int collectionFieldCount=0;
  for (int i=0; i < fields.size(); i++) {
    if (fields.get(i).isNotPersisted()) {
      continue;
    }
 else     if (fields.get(i).isOneToManyAssociation()) {
      collectionFieldCount++;
    }
 else {
      simpleFieldCount++;
    }
  }
  final ObjectAssociation[] oneToOneProperties=new ObjectAssociation[simpleFieldCount];
  final ObjectAssociation[] oneToManyProperties=new ObjectAssociation[collectionFieldCount];
  collectionMappers=new CollectionMapper[collectionFieldCount];
  final IsisConfiguration subset=IsisContext.getConfiguration().createSubset(parameterBase + ".mapper.");
  for (int i=0, simpleFieldNo=0, collectionFieldNo=0; i < fields.size(); i++) {
    final ObjectAssociation field=fields.get(i);
    if (field.isNotPersisted()) {
      continue;
    }
 else     if (field.isOneToManyAssociation()) {
      oneToManyProperties[collectionFieldNo]=field;
      final String type=subset.getString(field.getId());
      if (type == null || type.equals("association-table")) {
        collectionMappers[collectionFieldNo]=new MultiColumnCombinedCollectionMapper(oneToManyProperties[collectionFieldNo],parameterBase,lookup,objectMapperLookup);
      }
 else       if (type.equals("fk-table")) {
        final String property=parameterBase + field.getId() + ".element-type";
        final String elementType=configParameters.getString(property);
        if (elementType == null) {
          throw new SqlObjectStoreException("Expected property " + property);
        }
      }
 else {
        throw new NotYetImplementedException("for " + type);
      }
      collectionFieldNo++;
    }
 else     if (field.isOneToOneAssociation()) {
      oneToOneProperties[simpleFieldNo]=field;
      simpleFieldNo++;
    }
 else {
      oneToOneProperties[simpleFieldNo]=field;
      simpleFieldNo++;
    }
  }
  for (  final ObjectAssociation field : oneToOneProperties) {
    final FieldMapping mapping=lookup.createMapping(field);
    fieldMappings.add(mapping);
    fieldMappingLookup.put(field,mapping);
  }
}
