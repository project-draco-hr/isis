{
  try {
    final Class<? extends Dto> dtoClass=dto.getClass();
    final JAXBContext context=JAXBContext.newInstance(dtoClass);
    final PersistentEntityAdapter adapter=new PersistentEntityAdapter();
    container.injectServicesInto(adapter);
    final Marshaller marshaller=context.createMarshaller();
    marshaller.setAdapter(PersistentEntityAdapter.class,adapter);
    marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT,true);
    final StringWriter sw=new StringWriter();
    marshaller.marshal(dto,sw);
    return sw.toString();
  }
 catch (  final JAXBException ex) {
    throw new ApplicationException(ex);
  }
}
