{
  NakedClass cls=object.getNakedClass();
  ObjectData d=new ObjectData(object.getOid(),cls.fullName());
  Field[] fields=cls.getFields();
  for (int i=0; i < fields.length; i++) {
    Field field=fields[i];
    if (!field.isDerived()) {
      if (field instanceof Value) {
        NakedValue v=(NakedValue)field.get(object);
        d.addField(field.getName(),v.isEmpty() ? null : v.saveString());
      }
 else       if (field instanceof OneToManyAssociation) {
        InternalCollection coll=(InternalCollection)field.get(object);
        d.addField(field.getName(),createData(coll));
      }
 else       if (field instanceof OneToOneAssociation) {
        NakedObject ref=(NakedObject)field.get(object);
        Object refOid=ref == null ? null : new Data(ref.getOid(),ref.getClassName());
        d.addField(field.getName(),refOid);
      }
    }
  }
  return d;
}
