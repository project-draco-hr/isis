{
  final HibernateQueryCriteria hibernateCriteria=downcast(criteria);
  final List<Parameter> parms=hibernateCriteria.getQuery().getParameters();
  final ObjectSpecification[] specs=new ObjectSpecification[parms.size()];
  final ObjectAdapter[] objects=new ObjectAdapter[parms.size()];
  for (int i=0; i < parms.size(); i++) {
    final Parameter parm=parms.get(i);
    final ObjectAdapter adapter=getAdapterManager().getAdapterFor(parm.getValue());
    specs[i]=adapter.getSpecification();
    objects[i]=adapter;
  }
  final Data[] objectData=getObjectEncoder().encodeActionParameters(specs,objects,new KnownObjectsRequest());
  final byte[] serialisedQuery=serialise(hibernateCriteria.getQuery());
  return new HibernateQueryData(downcast(criteria),serialisedQuery,objectData);
}
