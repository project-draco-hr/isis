{
  response.setContentType("text/html");
  response.setCharacterEncoding(encoding);
  final Page page=controller.generatePage(context,req);
  if (context.isValid()) {
    if (controller.isDebug()) {
      controller.addDebug(page,req);
      addDebug(request,page);
    }
    PrintWriter writer;
    writer=response.getWriter();
    page.write(writer);
  }
 else {
    response.sendRedirect(getLogonPage());
  }
}
