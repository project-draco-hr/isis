{
  ObjectAdapter collection;
  String field=request.getOptionalProperty(FIELD);
  RequestContext context=request.getContext();
  if (field != null) {
    String id=request.getRequiredProperty(OBJECT);
    ObjectAdapter object=(ObjectAdapter)context.getMappedObjectOrResult(id);
    ObjectAssociation objectField=object.getSpecification().getAssociation(field);
    if (!objectField.isOneToManyAssociation()) {
      throw new ScimpiException("Field " + objectField.getId() + " is not a collection");
    }
    collection=objectField.get(object);
  }
 else {
    String id=request.getOptionalProperty(COLLECTION);
    collection=context.getMappedObjectOrResult(id);
  }
  TypeOfFacet facet=(TypeOfFacet)collection.getTypeOfFacet();
  String name=facet.valueSpec().getName();
  request.appendHtml(name);
}
