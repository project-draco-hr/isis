{
  final ObjectAdapter adapter=getAdapterFor(pojo);
  if (adapter != null) {
    return adapter;
  }
  final ObjectSpecification objSpec=getSpecificationLoader().loadSpecification(pojo.getClass());
  if (objSpec.containsFacet(ValueFacet.class)) {
    return createStandaloneAdapterAndSetResolveState(pojo);
  }
  final ObjectAdapter newAdapter;
  if (parentAdapter != null) {
    if (association != null) {
      if (association.isOneToManyAssociation()) {
        final OneToManyAssociation collection=(OneToManyAssociation)association;
        newAdapter=createCollectionAdapter(pojo,parentAdapter,collection);
      }
 else {
        newAdapter=createTransientRootAdapter(pojo);
      }
    }
 else {
      if (isAggregated(objSpec)) {
        final String aggregateLocalId=getOidGenerator().createAggregateLocalId(pojo);
        final AggregatedOid aggregatedOid=new AggregatedOid(parentAdapter.getOid(),aggregateLocalId);
        newAdapter=createAggregatedAdapter(pojo,aggregatedOid);
      }
 else {
        newAdapter=createTransientRootAdapter(pojo);
      }
    }
  }
 else {
    newAdapter=createTransientRootAdapter(pojo);
  }
  return mapAndInjectServices(newAdapter);
}
