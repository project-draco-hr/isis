{
  Image iconImage;
  if (height == image.getHeight(null)) {
    iconImage=image;
  }
 else {
    iconImage=image.getScaledInstance(-1,height,Image.SCALE_SMOOTH);
    if (iconImage != null) {
      mt.addImage(iconImage,0);
      try {
        mt.waitForAll();
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
      if (mt.isErrorAny()) {
        LOG.error("Failed to create scaled image: " + iconImage + " "+ mt.getErrorsAny()[0]);
        mt.removeImage(iconImage);
        iconImage=null;
      }
 else {
        mt.removeImage(iconImage);
        LOG.info("Image " + iconImage + " scaled to "+ height);
      }
    }
    if (iconImage == null || iconImage.getWidth(null) == -1) {
      throw new RuntimeException("scaled image! " + iconImage.toString());
    }
  }
  if (tint != null) {
    LOG.debug("tinting image " + tint);
    Toolkit.getDefaultToolkit().createImage(new FilteredImageSource(iconImage.getSource(),new Filter()));
  }
  return new Icon(iconImage);
}
