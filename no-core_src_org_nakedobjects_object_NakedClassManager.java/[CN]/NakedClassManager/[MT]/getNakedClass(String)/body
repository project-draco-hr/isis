{
  if (name == null) {
    throw new NullPointerException();
  }
  if (name.length() == 0) {
    throw new IllegalArgumentException("Class name is empty");
  }
  if (classes.containsKey(name)) {
    Object cls=classes.get(name);
    if (cls instanceof String) {
      throw new NakedObjectRuntimeException("Unwanted recursion - already creating NakedClass for " + name);
    }
    return (NakedClass)cls;
  }
 else {
    classes.put(name,name);
    try {
      try {
        NakedClass nc=loadClass(name);
        LOG.info("loaded class " + name + " from object store");
        classes.put(name,nc);
        return nc;
      }
 catch (      ObjectNotFoundException e) {
        LOG.info("create class " + name + ", and persist in object store");
        NakedClass nc=new NakedClass();
        nc.getName().setValue(name);
        nc.getReflector().setValue(classLoader.findType(name));
        LOG.debug(name + "/" + nc.getReflector().stringValue());
        createClass(nc);
        classes.put(name,nc);
        return nc;
      }
    }
 catch (    ObjectStoreException e) {
      throw new NakedObjectRuntimeException(e);
    }
  }
}
