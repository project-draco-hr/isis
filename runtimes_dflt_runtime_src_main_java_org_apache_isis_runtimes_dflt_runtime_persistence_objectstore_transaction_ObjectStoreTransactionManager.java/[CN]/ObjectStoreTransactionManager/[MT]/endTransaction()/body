{
  if (LOG.isInfoEnabled()) {
    LOG.info("endTransaction: level " + (transactionLevel) + "->"+ (transactionLevel - 1));
  }
  transactionLevel--;
  if (transactionLevel == 0) {
    LOG.info("endTransaction: committing");
    objectPersistor.objectChangedAllDirty();
    getTransaction().commit();
    objectStore.endTransaction();
  }
 else   if (transactionLevel < 0) {
    LOG.error("endTransaction: transactionLevel=" + transactionLevel);
    transactionLevel=0;
    throw new IllegalStateException(" no transaction running to end (transactionLevel < 0)");
  }
}
