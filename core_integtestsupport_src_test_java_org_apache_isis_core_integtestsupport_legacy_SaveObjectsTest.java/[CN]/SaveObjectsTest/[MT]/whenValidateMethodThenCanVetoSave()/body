{
  final Customer newCustomer=getDomainObjectContainer().newTransientInstance(Customer.class);
  newCustomer.setCustomerNumber(123);
  newCustomer.setFirstNameMandatory("Joe");
  newCustomer.setLastName("Smith");
  newCustomer.setCountryOfBirthMandatory(countryGbrDO);
  newCustomer.setMandatoryAssociation(countryGbrDO);
  newCustomer.setMandatoryValue("foo");
  newCustomer.setMaxLengthField("abc");
  newCustomer.setRegExCaseInsensitiveField("ABCd");
  newCustomer.setRegExCaseSensitiveField("abcd");
  final Customer newCustomerWO=getWrapperFactory().wrap(newCustomer);
  newCustomer.validate="No shakes";
  final WrapperObject newCustomerWrapper=asWrapperObject(newCustomerWO);
  try {
    assertThat(getDomainObjectContainer().isPersistent(newCustomer),is(false));
    newCustomerWrapper.save();
    fail("An InvalidImperativelyException should have been thrown");
  }
 catch (  final InvalidException ex) {
    assertThat(ex.getAdvisorClass(),classEqualTo(ValidateObjectFacetViaValidateMethod.class));
    assertThat(getDomainObjectContainer().isPersistent(newCustomer),is(false));
    assertThat(ex.getMessage(),Matchers.containsString("No shakes"));
  }
}
