{
  BasicConfigurator.configure();
  PropertiesConfiguration configuration=new PropertiesConfiguration(new PropertiesFileLoader(DEFAULT_CONFIG,false));
  PropertyConfigurator.configure(configuration.getProperties("log4j"));
  if (configuration.getString(SHOW_EXPLORATION_OPTIONS) == null) {
    configuration.add(SHOW_EXPLORATION_OPTIONS,"yes");
  }
  NakedObjectsClient nakedObjects=new NakedObjectsClient();
  nakedObjects.setConfiguration(configuration);
  Logger log=Logger.getLogger("Naked Objects");
  log.info(AboutNakedObjects.getName());
  log.info(AboutNakedObjects.getVersion());
  log.info(AboutNakedObjects.getBuildId());
  SplashWindow splash=null;
  boolean noSplash=configuration.getBoolean("nosplash",false);
  if (!noSplash) {
    splash=new SplashWindow();
  }
  File directory=new File(XmlDataManager.directory());
  String[] files=directory.list(new FilenameFilter(){
    public boolean accept(    File dir,    String name){
      return name.endsWith(".xml");
    }
  }
);
  for (int i=0; files != null && i < files.length; i++) {
    new File(directory,files[i]).delete();
  }
  try {
    JavaBusinessObjectContainer container=new JavaBusinessObjectContainer();
    JavaObjectFactory objectFactory=new JavaObjectFactory();
    objectFactory.setContainer(container);
    XmlObjectStore objectStore=new XmlObjectStore();
    objectStore.setDataManager(new XmlDataManager());
    DefaultPersistAlgorithm persistAlgorithm=new DefaultPersistAlgorithm();
    OidGenerator oidGenerator=new SimpleOidGenerator(1000);
    persistAlgorithm.setOidGenerator(oidGenerator);
    DefaultPersistAlgorithm algo=new DefaultPersistAlgorithm();
    algo.setOidGenerator(oidGenerator);
    ObjectStorePersistor objectManager=new ObjectStorePersistor();
    objectManager.setObjectStore(objectStore);
    objectManager.setPersistAlgorithm(persistAlgorithm);
    objectManager.setCheckObjectsForDirtyFlag(true);
    nakedObjects.setObjectPersistor(objectManager);
    ReflectionPeerFactory[] factories=new ReflectionPeerFactory[]{new TransactionPeerFactory()};
    JavaSpecificationLoader specificationLoader=new JavaSpecificationLoader();
    specificationLoader.setReflectionPeerFactories(factories);
    nakedObjects.setSpecificationLoader(specificationLoader);
    new SystemClock();
    nakedObjects.setSession(new SimpleSession());
    ObjectLoaderImpl objectLoader=new ObjectLoaderImpl();
    objectLoader.setPojoAdapterMap(new PojoAdapterHashMap());
    objectLoader.setAdapterFactory(new JavaAdapterFactory());
    objectLoader.setObjectFactory(objectFactory);
    nakedObjects.setObjectLoader(objectLoader);
    nakedObjects.init();
    JavaFixtureBuilder fb=new JavaFixtureBuilder();
    CitiesFixture cities;
    fb.addFixture(cities=new CitiesFixture());
    fb.addFixture(new BookingsFixture(cities));
    fb.addFixture(new ClassesFixture());
    fb.installFixtures();
    System.out.println("\n\nLoaded objects");
    System.out.println(objectLoader.getDebugData());
    System.out.println("\n\nState of ObjectManager");
    System.out.println(objectManager.getDebugData());
  }
  finally {
    if (splash != null) {
      splash.toFront();
      splash.removeAfterDelay(3);
    }
  }
}
