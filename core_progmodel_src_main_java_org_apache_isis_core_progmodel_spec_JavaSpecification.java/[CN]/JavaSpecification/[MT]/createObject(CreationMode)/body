{
  if (cls.isArray()) {
    return Array.newInstance(cls.getComponentType(),0);
  }
  try {
    Object object=getRuntimeContext().instantiate(cls);
    if (creationMode == CreationMode.INITIALIZE) {
      final ObjectAdapter adapter=getRuntimeContext().adapterFor(object);
      final List<ObjectAssociation> fields=adapter.getSpecification().getAssociations();
      for (int i=0; i < fields.size(); i++) {
        fields.get(i).toDefault(adapter);
      }
      getRuntimeContext().injectDependenciesInto(object);
      CallbackUtils.callCallback(adapter,CreatedCallbackFacet.class);
    }
    return object;
  }
 catch (  final ObjectInstantiationException e) {
    throw new IsisException("Failed to create instance of type " + cls.getName(),e);
  }
}
