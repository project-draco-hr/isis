{
  if (alreadyPersistedOrNotPersistableOrServiceOrStandalone(object)) {
    return;
  }
  final List<ObjectAssociation> fields=object.getSpecification().getAssociations();
  if (!object.getSpecification().isEncodeable() && fields.size() > 0) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("make persistent " + object);
    }
    CallbackUtils.callCallback(object,PersistingCallbackFacet.class);
    toPersistObjectSet.remapAsPersistent(object);
    object.changeState(ResolveState.SERIALIZING_RESOLVED);
    for (int i=0; i < fields.size(); i++) {
      final ObjectAssociation field=fields.get(i);
      if (field.isNotPersisted()) {
        continue;
      }
      if (field.isOneToManyAssociation()) {
        final ObjectAdapter collection=field.get(object);
        if (collection == null) {
          throw new ObjectPersistenceException("Collection " + field.getName() + " does not exist in "+ object.getSpecification().getFullIdentifier());
        }
        makePersistent(collection,toPersistObjectSet);
      }
 else {
        final ObjectAdapter fieldValue=field.get(object);
        if (fieldValue == null) {
          continue;
        }
        persist(fieldValue,toPersistObjectSet);
      }
    }
    toPersistObjectSet.addCreateObjectCommand(object);
    CallbackUtils.callCallback(object,PersistedCallbackFacet.class);
    object.changeState(ResolveState.SERIALIZING_RESOLVED.getEndState());
  }
}
