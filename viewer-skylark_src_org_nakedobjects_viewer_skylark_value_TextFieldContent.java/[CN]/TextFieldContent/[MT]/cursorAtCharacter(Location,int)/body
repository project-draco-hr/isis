{
  int x=atLocation.getX() - 3;
  int at=0;
  if ((displayFromLine + line) <= displayToLine) {
    String text=getText(line);
    int endAt=text.length();
    int width=0;
    while (at < endAt && x > width) {
      width+=forField.charWidth(text.charAt(at));
      at++;
    }
  }
 else {
    line=displayToLine;
    at=getText(line).length();
  }
  LOG.debug("Character at " + at + " line "+ line);
  return at;
}
