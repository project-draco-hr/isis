{
  if (!formatted) {
    breaks=new int[100];
    noBreaks=0;
    int length=text.length();
    int lineWidth=0;
    int breakAt=-1;
    for (int pos=0; pos < length; pos++) {
      char ch=text.charAt(pos);
      if (ch == '\n') {
        throw new IllegalStateException("Block must not contain newline characters");
      }
      lineWidth+=forField.charWidth(ch);
      if (lineWidth > forField.getMaxWidth()) {
        breakAt=(breakAt == -1) ? pos - 1 : breakAt;
        breakAt(breakAt);
        lineWidth=forField.stringWidth(text.substring(breakAt - 1,pos + 1));
        breakAt=-1;
        continue;
      }
      if (ch == ' ') {
        breakAt=pos + 1;
      }
    }
    formatted=true;
  }
}
