{
  if (object.getResolveState().isValidToChangeTo(resolveState)) {
    PersistorUtil.start(object,resolveState);
    updateFields(object,state);
    PersistorUtil.end(object);
  }
 else   if (object.getResolveState() == ResolveState.TRANSIENT && resolveState == ResolveState.TRANSIENT) {
    updateFields(object,state);
  }
 else {
    final ObjectData od=(ObjectData)state;
    if (od.containsField()) {
      throw new IsisException("Resolve state (for " + object + ") inconsistent with fact that data exists for fields");
    }
  }
}
