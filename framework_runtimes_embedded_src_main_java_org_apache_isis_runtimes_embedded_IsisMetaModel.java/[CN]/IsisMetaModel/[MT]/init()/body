{
  ensureNotInitialized();
  reflector=new ObjectReflectorDefault(configuration,classSubstitutor,collectionTypeRegistry,specificationTraverser,memberLayoutArranger,programmingModel,facetDecorators,metaModelValidator);
  runtimeContext=new RuntimeContextForEmbeddedMetaModel(context,services);
  this.container=new DomainObjectContainerWrapperFactory();
  runtimeContext.injectInto(container);
  runtimeContext.setContainer(container);
  runtimeContext.injectInto(reflector);
  reflector.injectInto(runtimeContext);
  reflector.init();
  runtimeContext.init();
  for (  final Object service : services) {
    final ObjectSpecification serviceSpec=reflector.loadSpecification(service.getClass());
    serviceSpec.markAsService();
  }
  state=State.INITIALIZED;
  wrapperFactory=container;
}
