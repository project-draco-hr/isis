{
  List<ObjectAdapter> argAdapters=parseArguments(action,arguments);
  List<ObjectActionParameter> parameters=action.getParameters();
  for (int i=0; i < parameters.size(); i++) {
    ObjectActionParameter parameter=parameters.get(i);
    ObjectAdapter argAdapter=argAdapters.get(i);
    if (argAdapter == null) {
      continue;
    }
    if (argAdapter.getSpecification().containsFacet(ValueFacet.class)) {
      Object arg=argAdapter.getObject();
      String reasonNotValid=parameter.isValid(objectAdapter,arg);
      if (reasonNotValid != null) {
        throw JsonApplicationException.create(HttpStatusCode.NOT_ACCEPTABLE,reasonNotValid);
      }
    }
  }
  ObjectAdapter[] argArray=argAdapters.toArray(new ObjectAdapter[0]);
  Consent consent=action.isProposedArgumentSetValid(objectAdapter,argArray);
  if (consent.isVetoed()) {
    throw JsonApplicationException.create(HttpStatusCode.NOT_ACCEPTABLE,consent.getReason());
  }
  final ObjectAdapter returnedAdapter=action.execute(objectAdapter,argArray);
  if (returnedAdapter == null) {
    return ResourceAbstract.responseOfNoContent(objectAdapter.getVersion()).build();
  }
  final JsonRepresentation representation;
  final CollectionFacet collectionFacet=returnedAdapter.getSpecification().getFacet(CollectionFacet.class);
  if (collectionFacet != null) {
    representation=representationWithSelfFor(RepresentationType.LIST,action,arguments);
    final Collection<ObjectAdapter> collectionAdapters=collectionFacet.collection(returnedAdapter);
    final RendererFactory factory=rendererFactoryRegistry.find(RepresentationType.LIST);
    final ListReprRenderer renderer=(ListReprRenderer)factory.newRenderer(resourceContext,null,representation);
    renderer.with(collectionAdapters).withReturnType(action.getReturnType()).withElementType(returnedAdapter.getElementSpecification());
    return ResourceAbstract.responseOfOk(renderer,Caching.NONE).build();
  }
  final EncodableFacet encodableFacet=returnedAdapter.getSpecification().getFacet(EncodableFacet.class);
  if (encodableFacet != null) {
    representation=representationWithSelfFor(RepresentationType.SCALAR_VALUE,action,arguments);
    final RendererFactory factory=rendererFactoryRegistry.find(RepresentationType.SCALAR_VALUE);
    ScalarValueReprRenderer renderer=(ScalarValueReprRenderer)factory.newRenderer(resourceContext,null,representation);
    renderer.with(returnedAdapter).withReturnType(action.getReturnType());
    return ResourceAbstract.responseOfOk(renderer,Caching.NONE).build();
  }
  final RendererFactory factory=rendererFactoryRegistry.find(RepresentationType.DOMAIN_OBJECT);
  representation=JsonRepresentation.newMap();
  final DomainObjectReprRenderer renderer=(DomainObjectReprRenderer)factory.newRenderer(resourceContext,null,representation);
  renderer.with(returnedAdapter);
  ResponseBuilder respBuilder=ResourceAbstract.responseOfOk(renderer,Caching.NONE);
  Version version=returnedAdapter.getVersion();
  if (version != null && version.getTime() != null) {
    respBuilder.tag("" + version.getTime());
  }
  return respBuilder.build();
}
