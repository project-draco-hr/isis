{
  DataNucleusTransaction transaction=new DataNucleusTransaction(this,messageBroker,updateNotifier,getTransactionalResource());
  List<Object> services=IsisContext.getServices();
  Optional<Object> optionalService=Iterables.tryFind(services,AUDIT_SERVICE);
  if (optionalService.isPresent()) {
    AuditService service=(AuditService)optionalService.get();
    transaction.usingAuditService(service);
  }
  return transaction;
}
