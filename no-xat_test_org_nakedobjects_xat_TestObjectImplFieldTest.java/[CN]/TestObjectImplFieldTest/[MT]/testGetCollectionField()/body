{
  DummyNakedObjectSpecification fieldSpec=new DummyNakedObjectSpecification();
  DummyNakedObjectSpecification objectSpec=new DummyNakedObjectSpecification();
  OneToOneAssociation field1=new OneToOneAssociationImpl("cls","one",fieldSpec,new DummyOneToOnePeer());
  OneToManyAssociation field2=new OneToManyAssociationImpl("cls","two",fieldSpec,new DummyOneToManyPeer());
  objectSpec.setupFields(new NakedObjectField[]{field1,field2});
  object.setupSpecification(objectSpec);
  DummyNakedObject fieldObject=new DummyNakedObject();
  fieldObject.setupResolveState(ResolveState.GHOST);
  object.setupFieldValue("one",fieldObject);
  DummyNakedCollection fieldCollection=new DummyNakedCollection();
  object.setupFieldValue("two",fieldCollection);
  target.expected.addExpectedMethod("fieldAccessorFor");
  target.expected.addExpectedParameter("two");
  target.setupField(field1);
  factory.calls.addExpectedMethod("createTestObject");
  factory.calls.addExpectedParameter(fieldObject);
  factory.calls.addExpectedParameter("cache");
  factory.calls.addExpectedMethod("createTestCollection");
  factory.calls.addExpectedParameter(fieldCollection);
  MockTestObject fieldTestObject=new MockTestObject();
  factory.setupObject(fieldTestObject);
  MockTestCollection fieldTestCollection=new MockTestCollection();
  factory.setupCollection(fieldTestCollection);
  TestNaked field=target.getField("two");
  assertEquals(fieldTestCollection,field);
  target.verify();
  factory.verify();
}
